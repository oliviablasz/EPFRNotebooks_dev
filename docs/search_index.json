[["index.html", "EPFR Strategy Notebooks 1 Introduction", " EPFR Strategy Notebooks 1 Introduction The objectives of this notebook are; to present EPFRs proof of concept strategies, so that readers have a profound understanding of their inputs and composition. the fundamentals will further supplement a users experience working with these data sets as they continue exploring for value and underlying meaning in our data. to enable the reader to construct signals and find initial value in the data. This book has ten proof-of-concept strategies created by Quantitative Analysts at EPFR. The backtesting methodology across each of these is relatively similar. They are quintile based, long/short, and we apply similar lookback periods for our backtests. We use a standard backtest period because we seek to avoid optimizing any one strategy. Our goal is to help the reader to construct a signal from EPFRs data, from which they can build off of and optimize for their own use cases. For this type of testing on our data, we provide the time series file available for download. To access the files you can find them readily available on the FTP, or email our team for assistance: click here. "],["epfr-library.html", "2 EPFR Library 2.1 About 2.2 ftp.get() 2.3 mat.read() 2.4 compound.flows() 2.5 bbk() 2.6 bbk.matrix()", " 2 EPFR Library The EPFR Library has an extensive list of applicable functions for use on our data and will be used in this demonstration of our strategies. To install the library EPFR, click here to download zip from github. Before installing the library EPFR, please install the dependencies this library requires: devtools, RODBC, and RDCOMClient. You can find the code to do this below. install.packages(&quot;RDCOMClient&quot;, repos = &quot;http://www.omegahat.net/R&quot;) x &lt;- c(&quot;devtools&quot;, &quot;RODBC&quot;, &quot;RDCOMClient&quot;) w &lt;- !is.element(x, dimnames(installed.packages())[[1]]) if (any(w)) for (y in x[w]) install.packages(y) Now you can properly install and load the library EPFR. library(&quot;devtools&quot;) install_github(&quot;vsrimurthy/EPFR&quot;) library(&quot;EPFR&quot;) 2.1 About Please refer to the library documentation for the description and complete list of parameters for each function. The functions that are used in this documents demonstration of EPFRs strategies include ftp.get(), mat.read(), compound.flows(), bbk(), Ctry.msci.members.rng(), Ctry.info(), ret.to.idx(), ret.idx.gaps.fix(), portfolio.beta.wrapper(), portfolio.residual(). 2.2 ftp.get() In this demonstration we will use the function ftp.get() from library('EPFR) to access files from EPFRs ftp which requires the RCurl library. library(RCurl) ## Warning: package &#39;RCurl&#39; was built under R version 4.1.2 To use this function you will set a file path to the csv file that will be used for your strategy and a local folder that this file will be downloaded to: file &lt;- &quot;EPFRHistory/Strategies/daily/FloPctCtry-daily.csv&quot; # FTP FILE - FloPctCtry-daily.csv fldr &lt;- &quot;C:\\\\temp&quot; # LOCAL FOLDER Next you will enter your username and password: usr &lt;- &quot;YOUR USER NAME&quot; # FTP USERNAME pwd &lt;- &quot;YOUR PASSWORD&quot; #FTP PASSWORD Now you can call ftp.get() with the following inputs: ftp.get(file, fldr, &quot;filetransport.epfrglobal.com&quot;, usr, pwd, &quot;ftp&quot;) # DOWNLOADS FILE FROM FTP TO LOCAL FOLDER, USING CREDENTIALS After the file is downloaded the flow files local path can be stored with follow line: flow.file &lt;- paste(fldr, ftp.file(file), sep = &quot;\\\\&quot;) # STORES FLOW FILE PATH 2.3 mat.read() should I replace all mat.read() with non EPFR library code? 2.4 compound.flows() EPFRs function compound.flows() is very simple but quickly compounds our percentage flow file over a trailing lookback period. compound.flows(&quot;DailyPercentageFlow.csv&quot;, lookback = 20) 2.5 bbk() EPFRs function bbk() is more complex as it creates our standard output model. This function requires many different parameters such as our compounded daily percentage flow file and a return file. x &lt;- &quot;Compounded Percentage Flow&quot; y &lt;- &quot;Return&#39;s&quot; hz &lt;- &quot;Return horizon&quot; nBin &lt;- &quot;Number of bins (to sort)&quot; doW &lt;- &quot;Day of the week to trade on&quot; delay &lt;- &quot;Delay in getting the data&quot; idx &lt;- &quot;Universe&quot; Please refer to the library documentation for the complete list of parameters of this function. bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay, idx) 2.6 bbk.matrix() "],["Filters.html", "3 Filters", " 3 Filters Work with Cam on adding some sort of tutorial/guide on this EPFR has an extensive list of over two dozen filters that can be applied to our data sets, therefore the signals we can get can be fine-tuned. The data can be filtered by: Investor Type (retail or institutional) Share class Fund domicile Theme (ESG, Sharia, ect.) Currency of flows Individual managers Duration Style Sector "],["flow-percentage-country-strategy.html", "4 Flow-Percentage Country Strategy 4.1 Overview 4.2 Daily Percentage Flow 4.3 Strategy Implementation", " 4 Flow-Percentage Country Strategy 4.1 Overview The Flow-Percentage Country Strategy is an equity based rotation strategy, which ranks different countries across a customized universe of both developed and emerging markets. This approach uses the stated allocations of equity funds with a cross-border focus and calculates percentage flow into countries. In terms of twenty-day percentage flows, the top fifth of ACWI countries outperform the bottom fifth by over 3% per year. The strategy works best in Emerging Markets, but adds value across the board. 4.2 Daily Percentage Flow The Flow-Percentage Country Strategy developed by EPFR Global is based on percentage flow into countries. In this section, the reader will gain an understanding of the aggregations which can be used to create a signal as well as the methodology behind daily percentage flow calculations. 4.2.1 Aggregations The first step is defining a subset of data to capture in calculating our signal. This strategy requires; Equity funds with a cross-boarder focus. These are essentially any fund that has a mandate spanning more than one country. The vast majority of these will be global and regional funds. Funds must report both daily flows and country allocations, since these values are needed to calculate Daily Percentage Flow. Cross-border equity funds, which report their country allocations and their fund flows, are a subset of those that only report their fund flows to EPFR. The figure below shows EPFRs coverage of this universe over time compared to our total coverage. Updated at the end of July each year Users looking for more specific detail can customize this aggregation even further using EPFRs fund-level or share class-level granularity. Some good examples would be Active/Passive, ETF or Mutual funds, Institutional or Retail. Users can use these tags to different degrees in creating aggregated signals to backtest. Further detail about this is available in section 3. This can be achieved using fund-level flow files or reaching out to EPFRs quant team for customized aggregations. 4.2.2 Calculation To begin calculating the Daily Percentage flow, we start with our subset of cross-border equity funds. To calculate the funds impact on a country, we scale a funds flow by multiplying it against its stated country allocation, which is available in EPFRs Country Allocation Database, on that day. EPFR releases country allocations of all funds on the \\(23^{\\text{rd}}\\) of each month (or the next available business day) at a monthly frequency. Hence, our calculation assumes constant country allocation between two consecutive release dates within the month. We then apply the same procedure to all funds with a fund flow and country allocation information and then sum the flows for each country across all funds. \\[\\text{Total Impact}_{c,t} = \\sum^{N}_{i=m}{\\text{Flow}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total Impact}\\) = the impact on a country \\(c\\), across all funds \\(i\\), for day \\(t\\) Additionally, we repeat the process across the same funds Assets held under Management (AuM), to get the total AuM held in a country. \\[\\text{Total AuM}_{c,t} = \\sum^{N}_{i=m}{\\text{AuM}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total AuM}\\) = the assets held in a country \\(c\\), across all funds \\(i\\), for day \\(t\\) Finally, to find the daily percentage flow for a country, we divide the Total Impact by the Total AuM. Then we repeat this across all different countries for the entire history. \\[\\text{Percentage Flow}_{c,t} = \\frac{\\text{Total Impact}_{c,t}}{\\text{Total AuM}_{c,t}}\\] Where: \\(\\text{Percentage Flow}\\) = the scaled flow as a percentage into a country \\(c\\), across all funds \\(i\\), for day \\(t\\) 4.2.3 Flow File The users may create flow percentages for their desired country aggregations and granularity using the methodology described in the previous section. EPFR also provides a pre-calculated aggregation for its users for the Daily Flow-Percentage Country Strategy. This file can be found on the FTP under the strategies folder. Please refer to the FTP Folder Structure section for the exact location of this file. This file contains daily cross-border equity fund flow data for 52 countries and is updated daily at 5:00 PM est. with a T+1 day lag. For this demonstration, we use the pre-calculated file FloPctCtry-daily.csv. Below shows a snippet of what this file contains. AU BR CA CN ID IN JP KR MX MY PH RU SG TH TR TW ZA AR CL CO CZ EG HU IL NZ NO PE PL SE CH GB AT BE DK FI FR DE GR IE IT NL PT ES HK US JO MA PK AE QA SA VN KW 20220201 0.0682839 0.0084836 0.1025408 0.0139744 0.0221570 0.0205982 0.0548555 0.0319277 0.0060054 0.0221536 0.0286116 0.0230859 0.0379905 0.0195777 0.0146236 0.0208210 0.0363276 0.0807825 0.0289586 0.0385508 0.0306830 0.0330318 0.0469420 0.0361752 0.0453934 0.1034383 -0.0009420 0.0483840 0.0732804 0.0681679 0.0814963 0.1422620 0.1951290 0.0597506 0.2557560 0.1649068 0.1873234 0.0161138 0.1056664 0.1899218 0.1672633 0.1732925 0.1840847 0.0328124 0.0580442 0.1000220 0.1490446 -0.0443664 0.0431735 0.0427901 0.0462380 -0.2165318 0.0299807 20220202 0.1071915 0.0281719 0.0950954 0.0202414 0.0344230 0.0163766 0.1111745 0.0417981 0.0245983 0.0504768 -0.0090245 0.0232131 0.0608292 0.0215472 -0.0117807 0.0184948 0.0378151 0.0529031 0.0224223 0.0489514 0.0360707 0.0268137 0.0133663 0.0955032 0.0783371 0.1482123 0.0650883 0.0575084 0.1073821 0.1102016 0.1021990 0.1753984 0.2864324 0.0724588 0.3588564 0.1960113 0.2311478 0.0461036 0.1557974 0.2426154 0.1954004 0.3344284 0.2244875 0.0394673 0.1199526 0.1302887 0.0396339 -0.0027174 0.0435513 0.0366501 0.0279959 0.0673499 0.0179536 20220203 0.0232839 0.0232704 0.0761505 0.0289616 0.0273847 0.0345332 0.0218809 0.0518640 0.0100158 0.0419875 0.0341742 0.0317831 0.0142656 0.0407090 -0.0425790 0.0449413 0.0516080 -0.0154822 0.0202419 0.0298686 0.0427326 -0.0100498 0.0006513 0.0224383 0.0630011 0.0594039 0.0454787 0.0349888 0.0310588 0.0406977 0.0843723 0.0592398 0.0618084 0.0473398 0.0813880 0.0405348 0.0415332 0.0349092 0.0467131 0.0649067 0.0371971 0.0825533 0.0770435 0.0275676 0.0901542 0.0017727 0.0246136 -0.0329425 0.0539309 0.0525786 0.0450357 -0.0297256 0.0293389 20220204 0.0427605 0.0005431 0.0182251 0.0287499 0.0712703 0.0435060 0.0363027 0.0484562 -0.0030307 0.0577206 0.0478340 -0.1376946 0.0192682 0.0321432 -0.1510468 0.0421362 0.0360338 0.0059707 0.0473132 0.0457560 0.0483058 -0.0528643 -0.1633261 -0.0060812 0.0199169 0.0299800 -0.0224904 -0.1080532 0.0151556 0.0154724 0.0360337 0.0249990 0.0172963 -0.0035172 0.0360927 0.0188039 0.0210176 -0.0338378 0.0008837 0.0172023 0.0118729 0.0078131 0.0379598 -0.0100599 0.0647590 -0.0866469 0.0035331 0.0121018 0.0245301 0.0388262 0.0097923 0.0291140 0.0293662 20220207 0.0441435 0.0664523 0.0375737 0.0818605 0.0600913 0.0626405 0.0510620 0.0711956 0.0639915 0.1208601 0.0704777 -0.0070066 0.0388531 0.1213585 -0.0351091 0.0684053 0.1530069 0.0202382 0.0663745 0.0377460 0.0608658 0.0361060 -0.0094240 0.0387820 0.0365660 0.0762125 0.0265846 -0.0243340 0.0134566 0.0106205 0.0437974 0.0323487 0.0402917 -0.0128579 0.0555223 0.0155998 0.0353678 0.0139098 0.0200929 0.0320488 -0.0032316 0.0231484 0.0331243 0.0682547 0.0168594 -0.0235971 0.3344607 0.1606458 0.0998821 0.1439076 0.0371702 0.1029100 0.0266549 20220208 0.0755702 0.1394943 0.0547752 0.0364907 0.0922338 0.0896671 0.0667618 0.0688405 0.1180297 0.1237705 0.0781433 -0.0512573 0.0673441 0.1097059 -0.0799028 0.0898746 0.1163105 0.0313015 0.0910412 0.0432795 0.0653109 0.1015608 -0.1620651 0.0553638 0.0604454 0.0494414 0.1915267 -0.0821655 0.0221925 0.0278058 0.0287122 0.0487003 0.0518997 -0.0119569 0.0578275 0.0392554 0.0331660 -0.0396982 0.0050530 0.0597397 0.0194525 0.0270428 0.0478461 -0.0445550 0.0560942 0.0545403 0.0111911 -0.0012755 0.1037661 0.1163175 0.1036285 0.1409731 0.0850615 We will download this file from the ftp using ftp.get(), more about this function can be referred to in section 2.2. file &lt;- &quot;EPFRHistory/Strategies/daily/FloPctCtry-daily.csv&quot; # PATH TO .csv FILE fldr &lt;- &quot;C:\\\\temp&quot; # LOCAL FOLDER ftp.get(file, fldr, &quot;filetransport.epfrglobal.com&quot;, w = &quot;username&quot;, h = &quot;password&quot;, &quot;ftp&quot;) # DOWNLOADS FILE FROM FTP TO LOCAL FOLDER, USING CREDENTIALS After downloading the csv file you will store its path as flow.file. A quick way to do this is shown below: flow.file &lt;- paste(fldr, ftp.file(file), sep = &quot;\\\\&quot;) # STORES FLOW FILE PATH, C:\\\\temp\\\\FloPctCtry-daily.csv 4.2.4 Return File The return file for this strategy should contain daily equity returns for each of the countries in the flow file, which the user can find with their own resources. EPFR also provides Fund Return data, that can be used as a proxy to returns. To create a return file using EPFR daily flow data, the following equation can be used: \\[\\text{Fund Return}_{c,t} = \\frac{\\sum^{N}_{i=m} \\text{Portfolio Change}_i}{\\sum^{N}_{i=m} \\text{Assets Start}_i}\\] Where: \\(\\text{Fund Return}\\) = the return value of country \\(c\\), across all funds \\(i\\), for day \\(t\\) For this demonstration, we will use a file that has calculated returns using EPFR daily flow data, which has been locally named ETFCountryReturns.csv. ret.file &lt;- &quot;ETFCountryReturns.csv&quot; For your reference a snippet of our return file looks like this CN US DE JP CH KR CA NO FI DK SG IT GB ZA FR IN BR MX HK SA NL AT MY ID PH TW TH ES RU AU IL TR CO CL PT QA AE SE GR AR IE PK PE BE NZ PL EG KW HU CZ 20220201 0.0528 0.6807 0.9277 0.1109 1.0060 0.0266 0.9667 1.6674 1.3189 0.5023 0.3032 1.7002 0.8981 0.7761 1.4507 0.3401 1.5622 0.8408 -0.0477 0.1305 1.3638 1.5419 0.0333 0.1077 0.0266 0.1177 0.6279 1.3858 0.8807 0.6846 0.5720 0.2966 0.2887 1.0968 1.0544 0.6692 -0.6105 1.2666 1.5714 0.7967 1.8938 0.4939 -1.1652 0.9925 1.4238 1.3499 0.4825 0.2188 1.1210 0.0000 20220202 -0.0867 0.8666 -0.0039 1.9440 0.1475 0.0958 0.3490 0.6455 -0.0258 2.2334 -0.1437 0.6959 0.6842 0.0300 0.2433 0.6528 -1.1236 0.4987 0.1409 -1.0146 0.1287 0.9670 0.0552 0.3764 1.3614 0.1406 0.0594 0.0743 -0.1022 1.1362 0.1513 -1.0736 -0.5534 -1.7402 0.5693 0.4672 0.3516 0.7643 1.0475 -1.8391 0.6640 1.1483 -0.5150 0.3911 1.8043 2.1435 0.6968 -0.0155 -0.8927 1.3861 20220203 -0.1321 -2.5502 -1.4775 -0.9492 -1.2167 0.9151 -1.1305 -0.7910 -1.6100 -2.6104 1.5806 -1.0768 -0.7611 -0.1806 -1.5306 -1.4224 -0.3573 -1.6707 -0.1897 -0.7212 -2.3562 -0.4186 0.4914 -0.4970 -1.0256 -0.4431 0.0992 -0.0551 -2.3408 -0.2445 -2.6861 -2.6172 -0.8933 -3.0547 -0.0943 0.4090 -0.4676 -2.0693 -0.5766 -3.0423 -1.5168 0.1154 -1.8198 -1.3327 0.4038 0.1845 -0.7130 0.0140 -0.1139 1.1345 20220204 0.4398 0.5485 -1.6049 0.6096 -0.7628 1.4880 0.6421 0.5062 -1.3078 -2.2127 0.6951 -1.7639 -0.2331 0.1243 -0.6771 -0.0669 -0.0081 0.0665 1.5711 0.0420 -0.0763 -0.3650 0.0746 0.4844 0.6340 -0.1192 0.7156 -0.7339 0.9929 0.5339 0.9000 -1.1930 0.4673 -1.4556 0.2832 0.1202 0.1187 -1.1211 -0.1600 0.3451 -0.2468 0.6965 0.5632 -1.1633 -0.1374 -2.4278 0.0753 0.0702 -1.1880 -0.6109 20220207 -0.5363 -0.3780 0.6202 -0.3630 0.4135 -1.1015 -0.0664 1.0660 1.5235 0.5081 1.0679 -1.3351 0.7146 0.4623 0.7620 -1.2052 0.5851 0.0349 0.6150 0.9914 0.9047 0.5188 0.3630 1.3036 -1.3927 0.8490 0.3553 -0.7028 0.0957 -0.0335 0.2399 2.1873 0.7078 1.3632 -0.4709 0.0419 0.2595 0.7838 -0.5840 0.6074 1.0571 -0.1228 0.4749 0.5235 -0.3023 0.2147 -0.3074 0.2107 -0.8987 0.4450 20220208 0.4547 0.9078 0.2616 0.3613 -0.4066 -0.0071 0.5817 -1.3078 -0.2124 -1.8623 1.1402 0.3929 -0.0130 0.9262 0.3194 0.3737 0.1921 1.7867 1.1586 -0.0606 0.1636 0.8854 0.0572 -0.1082 0.7833 0.5241 0.7130 1.3813 3.1033 1.0771 0.4657 1.3444 -0.5823 1.4735 0.0000 0.0104 0.6235 -0.2887 0.8745 0.6914 0.1665 0.2487 4.2177 0.4941 0.3751 2.0799 0.0127 0.5686 0.4925 1.2380 4.3 Strategy Implementation The final step is implementing this strategy to create a signal. Lets begin by reading in the flow and return files to our R studio work space. x &lt;- mat.read(flow.file) # GET FLOW PERCENTAGE y &lt;- mat.read(ret.file) # GET RETURN One of our first options is choosing the universe we want to use. EPFR has tested this signal within three different universes of countries ACWI (All Country World Index), EAFE (Europe, Australasia, and the Far East (EAFE), and EM (Emerging Markets). For this example, we choose ACWI, which includes 52 countries. idx &lt;- &quot;ACWI&quot; Then, to subset the flow file \\(x\\) to the selected universe \\(idx\\) the function Ctry.msci.members.rng() from the library('EPFR') is used. This function returns a list of two letter country codes from \\(idx\\) that are in \\(x\\). x &lt;- x[, is.element(dimnames(x)[[2]], Ctry.msci.members.rng(idx, dimnames(x)[[1]][1], dimnames(x)[[1]][dim(x)[1]]))] # SUBSET TO INDEX COUNTRIES We will also subset the return file \\(y\\) to use the same countries as \\(x\\). y &lt;- y[, dimnames(x)[[2]]] # TOTAL RETURN INDEX * Note: subsetting can be also be done when creating the flow and return files 4.3.1 Compounding Flows Next, we set up a variable for our look-back period, which can also be called a flow window. This variable will be the window of time we use to create a trailing compounded daily percentage flow. The look-back period we choose for our demonstrations is 20 days. lookback &lt;- 20 # FLOW WINDOW (IN WEEKDAYS) - 20 day look back period Again, using a function from the library('EPFR'), compound.flows() compounds the daily percentage flow over the trailing lookback period for each country. x &lt;- compound.flows(x, lookback, F) # COMPOUND FLOWS AU BR CA CN ID IN JP KR MX MY PH RU SG TH TR TW ZA AR CL CO CZ EG HU IL NZ NO PE PL SE CH GB AT BE DK FI FR DE GR IE IT NL PT ES HK US PK AE QA SA KW 20220201 1.3745739 0.1698093 2.0709179 0.2798596 0.4440739 0.4127714 1.1028471 0.6404943 0.1201757 0.4440048 0.5737908 0.4627318 0.7625579 0.3922823 0.2928791 0.4172441 0.7290657 1.6281100 0.5807690 0.7738465 0.6154518 0.6627127 0.9430395 0.7259949 0.9117943 2.0892210 -0.0188375 0.9721411 1.4758556 1.3722231 1.6426067 2.8840243 3.9757768 1.2018186 5.2413297 3.3503196 3.8138943 0.3227706 2.1346770 3.8677571 3.3989597 3.5235059 3.7467965 0.6582967 1.167308 -0.8835986 0.8670200 0.8592906 0.9288324 0.6013240 20220202 2.1658026 0.5649491 1.9191882 0.4056074 0.6907155 0.3280427 2.2471303 0.8392891 0.4931169 1.0143913 -0.1803346 0.4652878 1.2236408 0.4318273 -0.2353515 0.3705473 0.7590251 1.0633973 0.4494022 0.9835933 0.7238909 0.5376412 0.2676650 1.9274939 1.5784568 3.0063563 1.3098461 1.1564743 2.1696923 2.2272597 2.0639470 3.5670415 5.8872436 1.4591951 7.4271557 3.9940899 4.7258927 0.9261221 3.1624999 4.9657915 3.9814096 6.9053940 4.5868026 0.7923136 2.426589 -0.0543334 0.8746384 0.7355596 0.5614094 0.3596857 20220203 0.4667092 0.4664379 1.5340776 0.5808277 0.5491221 0.6929345 0.4385297 1.0424063 0.2005063 0.8431085 0.6857084 0.6375850 0.2856995 0.8173357 -0.8481448 0.9026743 1.0372360 -0.3091882 0.4056182 0.5990695 0.8581312 -0.2008043 0.0130265 0.4497235 1.2675911 1.1948062 0.9135136 0.7021061 0.6230123 0.8171096 1.7010403 1.1914877 1.2434544 0.9510664 1.6404071 0.8138249 0.8339502 0.7005049 0.9384187 1.3061704 0.7465761 1.6640789 1.5522009 0.5527984 1.818610 -0.6567920 1.0841626 1.0568420 0.9045782 0.5884164 20220204 0.8586920 0.0108617 0.3651346 0.5765709 1.4350977 0.8737266 0.7285640 0.9735987 -0.0605964 1.1607634 0.9610394 -2.7181648 0.3860712 0.6448299 -2.9779774 0.8461050 0.7231481 0.1194810 0.9505289 0.9191093 0.9705630 -1.0519922 -3.2163326 -0.1215539 0.3990930 0.6013104 -0.4488489 -2.1390233 0.3035487 0.3099034 0.7231470 0.5011693 0.3464952 -0.0703209 0.7243347 0.3767507 0.4211921 -0.6745845 0.0176745 0.3446079 0.2377254 0.1563783 0.7619407 -0.2010068 1.303180 0.2423150 0.4917467 0.7793950 0.1960282 0.5889650 20220207 0.8865824 1.3374708 0.7541617 1.6500052 1.2087114 1.2602932 1.0262085 1.4335837 1.2876403 2.4451577 1.4190320 -0.1400389 0.7799376 2.4553569 -0.6998447 1.3770336 3.1050299 0.4055433 1.3358945 0.7576325 1.2243814 0.7246025 -0.1883114 0.7785051 0.7338660 1.5353360 0.5330373 -0.4855565 0.2694757 0.2126247 0.8796015 0.6489660 0.8089269 -0.2568446 1.1163227 0.3124594 0.7097380 0.2785634 0.4026259 0.6429314 -0.0646131 0.4639872 0.6645744 1.3739815 0.337728 3.2624246 2.0167118 2.9178413 0.7460351 0.5344499 20220208 1.5223032 2.8271682 1.1012240 0.7323499 1.8609299 1.8087005 1.3437384 1.3858505 2.3872503 2.5047334 1.5745229 -1.0201689 1.3555346 2.2171369 -1.5859842 1.8129213 2.3520941 0.6278959 1.8366586 0.8691589 1.3143535 2.0509329 -3.1918798 1.1131187 1.2158760 0.9934858 3.9010377 -1.6305468 0.4447873 0.5575871 0.5758132 0.9785246 1.0431279 -0.2388666 1.1629257 0.7880438 0.6654131 -0.7909778 0.1011086 1.2015997 0.3897703 0.5422486 0.9612847 -0.8873387 1.127884 -0.0255065 2.0959074 2.3522366 2.0931014 1.7150480 4.3.2 Ranking Countries Next, we sort the countries in each universe into five equal bins based on their 20-day Percentage Flow Compounded value for the selected holding period. To do this, we will use the function from library('EPFR'), called bbk(). This function will output a standardized backtest result. Th bbk() function requires our compounded daily percentage flow file, a return file, and our selected universe. Please refer to the library documentation for the complete list of parameters of this function. The first parameter we add is the number of bins we want to use. For our case, we want to use 5 because our strategy is to go long the top fifth and short the bottom fifth. nBin &lt;- 5 # NUMBER OF BINS Since EPFR data is published with T+1 day lag and is released around 5:00 pm EST, we account for a T+2 day delay in our model since that is when one can trade on the information. Users interested in more timely signals can also use the T+2 Open Prices for backtesting purposes. EPFR also offers a Premium Daily offering, an earlier release of the end-of-day data covering a significant subset of fund-level flow information. delay &lt;- 2 # DELAY IN KNOWING DATA (IN WEEKDAYS) - data takes time to have It is also important to note that this model will need to be re-balanced weekly. The day of the week the rebalancing occurs is at the discretion of the user. For this example we will set the day of the week to trade as Friday. doW &lt;- 5 # DAY OF THE WEEK YOU WILL TRADE ON (5 = FRIDAYS) Additionally, we also evaluate the returns for different holding periods. The user can input return horizions that they are interested in here. For this example we define a return horizon for weekly, fortnightly, monthly, bi-monthly, quarterly, and semi-annually. hz &lt;- c(5, 10, 20, 45, 65, 130) # RETURN HORIZON (IN WEEKDAYS) - holding periods Now that we have defined all of our inputs, to rank the countries into quintiles by their 20-day percentage flow, we call function bbk() for a 1-week holding period. z &lt;- bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay, idx) 4.3.3 Model Twenty-day flow percentage ranked into quintiles (computed only where forward returns are available) z[[&quot;bins&quot;]] AU BR CA CN ID IN JP KR MX MY PH RU SG TH TR TW ZA AR CL CO CZ EG HU IL NZ NO PE PL SE CH GB AT BE DK FI FR DE GR IE IT NL PT ES HK US PK AE QA SA KW 20220225 1 1 1 1 3 3 2 2 1 2 3 1 3 1 5 2 2 NA 3 3 4 5 1 3 2 4 2 2 3 4 3 4 4 5 4 4 4 2 5 5 5 4 5 1 1 NA 5 5 3 5 20220218 4 1 5 2 1 4 3 5 1 2 5 2 2 3 5 3 4 NA 1 2 1 5 1 4 5 1 1 2 5 4 2 5 3 5 3 2 3 3 4 1 4 4 2 1 5 NA 3 3 3 4 20220211 3 3 2 4 5 5 4 5 4 1 4 5 5 4 3 4 2 NA 1 3 2 4 5 5 5 1 5 5 2 2 1 3 1 3 1 3 2 3 4 2 4 2 1 3 3 NA 1 1 2 1 20220204 2 4 2 5 4 5 2 3 4 3 5 5 3 5 5 5 4 NA 5 3 4 4 5 2 3 2 3 3 2 2 2 1 1 3 1 1 1 3 1 1 1 1 1 4 2 NA 3 4 4 5 Quintile Returns over the equal-weight universe z[[&quot;rets&quot;]] Q1 Q2 Q3 Q4 Q5 TxB uRet 20220225 -3.8074779 2.9433733 2.9743461 -3.6265012 1.4479469 -5.2554248 -4.6152826 20220218 -0.1987113 -2.9723116 1.0994911 1.3444021 0.5643387 -0.7630500 -2.7415387 20220211 0.3127637 -0.3832483 -0.3584539 0.2750265 0.1430898 0.1696739 -0.9261476 20220204 -0.4101753 -0.5716855 0.3224336 0.2435449 0.3830683 -0.7932436 1.3032221 4.3.4 Performance Performance over all holding periods fcn &lt;- function(retW) {as.matrix(bbk(x, y, 1, retW, 5, doW, T, 0, delay, idx)$summ)} # DEFINE SUMMARY FUNCTION mat.ex.array3d(sapply(split(hz, hz), fcn, simplify = &quot;array&quot;)) # WRITE SUMMARIES Q1 Q2 Q3 Q4 Q5 TxB uRet Bi-Monthly AnnMn -1.359419e+00 -1.200041e+00 9.810921e-01 1.138329e+00 5.600293e-01 -1.919448e+00 5.121694e+00 AnnSd 5.363277e+00 4.561464e+00 4.679822e+00 5.194904e+00 5.826330e+00 9.729453e+00 1.590478e+01 Sharpe -2.536235e+01 -2.562839e+01 2.072012e+01 2.159664e+01 1.080984e+01 -2.005678e+01 3.236592e+01 HitRate -6.410256e+00 -6.980057e+00 3.276353e+00 4.131054e+00 6.695157e+00 -6.410256e+00 1.239316e+01 Beta -6.997780e-02 -3.748720e-02 9.633100e-03 1.115320e-02 8.737360e-02 -1.573514e-01 1.000000e+00 Alpha -1.014236e+00 -1.010299e+00 9.199667e-01 1.090005e+00 1.300809e-01 -1.144316e+00 0.000000e+00 DrawDn -2.217271e+01 -1.764852e+01 -9.209189e+00 -9.843321e+00 -1.344598e+01 -3.909681e+01 -2.647945e+01 DDnBeg 2.015844e+07 2.016195e+07 2.017180e+07 2.017512e+07 2.018722e+07 2.015631e+07 2.018901e+07 DDnN 2.344444e+01 2.277778e+01 9.555556e+00 1.200000e+01 9.444444e+00 2.922222e+01 7.777778e+00 AnnTo 4.260997e+02 4.526017e+02 4.635711e+02 4.531321e+02 4.183813e+02 8.444810e+02 0.000000e+00 Fortnightly AnnMn -1.594095e+00 -1.722337e+00 9.455191e-01 -1.981436e-01 2.553882e+00 -4.147978e+00 4.600071e+00 AnnSd 5.548528e+00 5.575056e+00 5.221758e+00 4.755291e+00 6.061398e+00 9.716132e+00 1.544202e+01 Sharpe -2.691700e+01 -2.688171e+01 1.907280e+01 -6.462379e+00 4.117461e+01 -4.088036e+01 2.977771e+01 HitRate -3.072626e+00 -1.396648e+00 3.910614e+00 -2.793296e-01 4.469274e+00 -4.189944e+00 7.541899e+00 Beta -3.022910e-02 -5.002290e-02 -1.196740e-02 -5.605300e-03 9.974920e-02 -1.299783e-01 1.000000e+00 Alpha -1.454824e+00 -1.487861e+00 1.012512e+00 -1.721106e-01 2.078459e+00 -3.533283e+00 0.000000e+00 DrawDn -2.290282e+01 -2.813970e+01 -1.188070e+01 -1.722588e+01 -1.184712e+01 -5.011044e+01 -3.471675e+01 DDnBeg 2.017591e+07 2.015561e+07 2.016556e+07 2.019062e+07 2.015052e+07 2.018058e+07 2.019012e+07 DDnN 9.200000e+01 1.180000e+02 7.850000e+01 5.000000e+01 8.000000e+01 9.850000e+01 3.050000e+01 AnnTo 1.799100e+03 1.969044e+03 2.088735e+03 1.960248e+03 1.769727e+03 3.568827e+03 0.000000e+00 Monthly AnnMn -1.642852e+00 -2.379442e+00 1.054973e+00 1.005128e+00 1.992229e+00 -3.635081e+00 4.665762e+00 AnnSd 5.722100e+00 5.070448e+00 4.786104e+00 5.090070e+00 5.612247e+00 9.430070e+00 1.571243e+01 Sharpe -2.889227e+01 -4.487361e+01 2.267691e+01 1.698998e+01 3.562111e+01 -3.801441e+01 2.988173e+01 HitRate -4.494382e+00 -2.528090e+00 3.932584e+00 1.404494e+00 3.932584e+00 -5.617978e+00 8.707865e+00 Beta -3.499800e-02 -3.088010e-02 -1.471820e-02 -6.717700e-03 8.591090e-02 -1.209089e-01 1.000000e+00 Alpha -1.490871e+00 -2.213243e+00 1.126259e+00 1.024974e+00 1.589400e+00 -3.080271e+00 0.000000e+00 DrawDn -2.144950e+01 -2.408110e+01 -1.004656e+01 -1.329078e+01 -1.029527e+01 -4.554308e+01 -3.115392e+01 DDnBeg 2.015566e+07 2.015584e+07 2.017552e+07 2.018559e+07 2.017302e+07 2.015791e+07 2.019014e+07 DDnN 8.075000e+01 6.700000e+01 1.350000e+01 2.475000e+01 1.700000e+01 6.025000e+01 1.525000e+01 AnnTo 9.186017e+02 9.991417e+02 1.039645e+03 1.003280e+03 9.226186e+02 1.841220e+03 0.000000e+00 Quarterly AnnMn -1.082063e+00 -1.204928e+00 5.698990e-01 9.099097e-01 8.957379e-01 -1.977801e+00 5.377233e+00 AnnSd 5.118570e+00 4.644309e+00 4.635246e+00 4.764066e+00 5.826584e+00 9.358104e+00 1.548786e+01 Sharpe -2.103167e+01 -2.614450e+01 1.336660e+01 2.307477e+01 1.535224e+01 -2.049509e+01 3.496609e+01 HitRate -1.906640e+00 -4.240631e+00 9.752356e-01 3.396888e+00 5.960991e+00 -6.223975e+00 1.456279e+01 Beta -9.559700e-02 -2.351600e-02 7.204500e-03 3.485480e-02 7.796950e-02 -1.735665e-01 1.000000e+00 Alpha -5.844420e-01 -1.081163e+00 5.114172e-01 7.507439e-01 4.854999e-01 -1.069942e+00 0.000000e+00 DrawDn -1.936904e+01 -1.584372e+01 -1.073019e+01 -9.863004e+00 -1.155713e+01 -3.574441e+01 -2.365275e+01 DDnBeg 2.015911e+07 2.015928e+07 2.016374e+07 2.016912e+07 2.019045e+07 2.015610e+07 2.018586e+07 DDnN 1.515385e+01 1.700000e+01 1.138462e+01 9.692308e+00 8.000000e+00 1.676923e+01 3.076923e+00 AnnTo 3.030545e+02 3.190947e+02 3.221078e+02 3.127066e+02 3.021122e+02 6.051667e+02 0.000000e+00 Semi-Annual AnnMn -7.395434e-01 -7.564661e-01 5.687789e-01 2.985258e-01 6.974959e-01 -1.437039e+00 6.217397e+00 AnnSd 4.666853e+00 4.515898e+00 4.467610e+00 4.317036e+00 5.240529e+00 8.410533e+00 1.434628e+01 Sharpe -1.913096e+01 -1.599572e+01 1.229792e+01 8.349892e+00 1.224202e+01 -1.830909e+01 4.427210e+01 HitRate -6.089744e+00 -3.229783e+00 2.712032e+00 3.205128e-01 3.229783e+00 -4.191321e+00 1.918146e+01 Beta -6.903660e-02 -5.552530e-02 7.710000e-05 5.746350e-02 6.681950e-02 -1.358561e-01 1.000000e+00 Alpha -3.843491e-01 -4.424020e-01 6.081001e-01 -2.770900e-02 3.204350e-01 -7.047841e-01 0.000000e+00 DrawDn -1.503742e+01 -1.263258e+01 -9.182900e+00 -9.778959e+00 -1.094136e+01 -2.489010e+01 -1.752810e+01 DDnBeg 2.016265e+07 2.016462e+07 2.017176e+07 2.017380e+07 2.017445e+07 2.015813e+07 2.017642e+07 DDnN 6.692308e+00 6.230769e+00 4.576923e+00 4.730769e+00 4.807692e+00 7.461538e+00 2.307692e+00 AnnTo 1.542204e+02 1.624956e+02 1.640224e+02 1.627208e+02 1.607292e+02 3.149496e+02 0.000000e+00 Weekly AnnMn -2.240782e+00 -1.986659e+00 1.664271e+00 9.919638e-01 1.728825e+00 -3.969607e+00 4.584185e+00 AnnSd 5.734055e+00 5.114462e+00 5.761756e+00 5.066544e+00 6.061515e+00 9.951593e+00 1.482577e+01 Sharpe -3.907849e+01 -3.884395e+01 2.888479e+01 1.957871e+01 2.852133e+01 -3.988916e+01 3.092039e+01 HitRate 2.367688e+00 -1.253482e+00 1.810585e+00 3.481894e+00 3.760446e+00 9.749304e-01 5.710306e+00 Beta 3.744320e-02 -7.129520e-02 -2.741120e-02 1.818200e-02 4.266380e-02 -5.220600e-03 1.000000e+00 Alpha -2.412429e+00 -1.659829e+00 1.789929e+00 9.086142e-01 1.533246e+00 -3.945675e+00 0.000000e+00 DrawDn -3.146353e+01 -1.987673e+01 -1.399689e+01 -2.035128e+01 -1.734149e+01 -6.021224e+01 -3.837292e+01 DDnBeg 2.017090e+07 2.015082e+07 2.018033e+07 2.019082e+07 2.015052e+07 2.017112e+07 2.018013e+07 DDnN 2.370000e+02 3.400000e+02 6.800000e+01 6.700000e+01 1.320000e+02 2.250000e+02 1.120000e+02 AnnTo 3.493705e+03 3.909415e+03 4.152999e+03 3.834417e+03 3.491613e+03 6.985317e+03 0.000000e+00 Annualized mean one-week returns bbk(x, y, 1, hz[1], 5, doW, T, 0, delay)$annSumm # DISPLAY CALENDAR-YEAR RETURNS Q1 Q2 Q3 Q4 Q5 TxB uRet nPrds 2015 14.8371796 2.3457191 5.599829 -8.697116 -13.456667 28.293847 -25.043977 32 2016 0.0572224 -4.4710365 -1.512900 3.347425 2.466928 -2.409705 9.403868 53 2017 1.2817207 1.4315885 -2.409724 4.560159 -4.507233 5.788954 18.308649 52 2018 -5.7486533 -1.4605329 -2.560862 3.161225 6.586449 -12.335102 -12.123279 52 2019 -7.0731274 -0.5361163 -5.556690 3.127557 9.367909 -16.441036 16.383026 52 2020 -4.3998018 6.1541541 1.874302 -14.814486 11.185832 -15.585633 4.955824 52 2021 -7.2500090 -4.2353023 6.201192 8.787460 -3.503341 -3.746668 12.727776 53 2022 -31.1792803 -9.6182339 5.595014 -0.358124 35.560624 -66.739904 -6.838586 13 "],["multi-asset-strategy.html", "5 Multi-Asset Strategy 5.1 Overview 5.2 Daily Percentage Flow 5.3 Strategy Implementation", " 5 Multi-Asset Strategy 5.1 Overview This is a Multi-Asset Strategy, where we are essentially rotating between asset classes within the equity and bond universes. This approach uses active equity and fixed income funds to calculate percentage flow into asset classes. In terms of twenty-day percentage flows, the top fifth of asset classes outperform the bottom fifth by 10% per year. The strategy works well whether you consider only equity or fixed income asset classes. 5.2 Daily Percentage Flow The Multi-Asset Strategy developed by EPFR Global is based on percentage flow into asset classes. In this section, the reader will gain an understanding of the aggregations which can be used to create a signal as well as the methodology behind daily percentage flow calculations. 5.2.1 Aggregations The first step is defining a subset of data to capture in calculating our signal. For this strategy we can include equity, fixed-income, or both types of asset classes. Although, we will limit ourselves to actively managed funds when compiling the raw equity data. Equity and Fixed income (i.e. Multi-Asset) funds, which report their daily flows, are only a subset of those that report their fund flows to EPFR. The figure below shows EPFRs coverage of these universes over time compared to our total coverage. Updated at the end of July each year Users looking for more specific detail can customize this aggregation even further using EPFRs fund-level or share class-level granularity. Some good examples would be Active/Passive, ETF or Mutual funds, Institutional or Retail. Users can use these tags to different degrees in creating aggregated signals to backtest. Further detail about this is available in section 3. This can be achieved using fund-level flow files or reaching out to EPFRs quant team for customized aggregations. 5.2.2 Calculation To begin calculating the Daily Percentage flow, we start with our subset of Multi-Asset funds. To calculate the flow into an asset class, we sum the flows into funds that invest in that asset class. We repeat the process across the same funds Assets held under Management (AuM), to get the total AuM held in an asset class. Finally, to find the daily percentage flow for an asset class, we divide the flow into by the assets held. Then we repeat this across all different asset classes for the entire history. \\[\\text{Percentage Flow}_{c,t} = \\frac{\\sum^{N}_{i=m} \\text{Flow}_{i}}{\\sum^{N}_{i=m}{\\text{AuM}_{i}}}\\] Where: \\(\\text{Percentage Flow}\\) = the scaled flow as a percentage into an asset class \\(c\\), across all funds \\(i\\), for day \\(t\\) 5.2.3 Flow File The users may create flow percentages for their desired Equity and Fixed Income (Multi-Asset) aggregations and granularity using the methodology described in the previous section. EPFR also provides a pre-calculated aggregations for its users for the Multi-Asset Strategy. These files can be found on the FTP under the strategies folder. Please refer to the FTP Folder Structure section for the exact location of this file. These files contains daily flow data for asset classes listed below and are both updated daily at 5:00 PM est. with a T+1 day lag. Asset Classes 7 Global Equity Regions: Asia ex Japan Europe ex UK Japan Latin America Pacific ex Japan United Kingdom United States 10 Fixed Income: Global Emerging Markets Western Europe Bond High Yield Bond Floating Rate Funds USA Treasuries - USA Treasuries - Long USA Treasuries - Short Cash USA Munis Global Fixed Income For this demonstration, we use the pre-calculated files MultiAsset-Rgn-daily.csv and MultiAsset-FI-daily.csv. Below shows a snippet of what these files contain. AsiaXJP EurXGB Japan LatAm PacXJP UK USA 20220201 -0.018399 0.001783 0.018716 -0.085691 0.010789 -0.085311 0.029048 20220202 0.003781 0.036108 -0.047407 0.050266 0.030362 -0.063993 -0.006215 20220203 0.053863 0.088853 0.038014 0.024156 0.004486 -0.126909 0.011225 20220204 0.093861 -0.009848 -0.023898 0.048017 -0.096440 -0.013633 0.000522 20220207 0.039187 -0.012996 0.010978 0.062107 -0.000968 -0.027620 -0.012000 20220208 0.038420 0.038914 -0.034377 0.261600 0.011605 -0.004476 0.012813 GLOBEM WESEUR HYIELD FLOATS USTRIN USTRLT USTRST CASH USMUNI GLOFIX 20220201 -0.123629 -0.046076 -0.168547 0.341438 -0.070586 -1.001112 1.355719 0.352572 0.043812 -0.108978 20220202 0.031682 0.090935 0.253651 0.429983 0.685248 0.732084 0.458490 -0.021312 0.036411 -0.027892 20220203 -0.010625 -0.036078 -0.137683 0.194747 0.587755 0.662947 -0.192861 0.025251 0.018182 -0.001209 20220204 -0.016889 -0.083399 -0.404042 0.294103 -0.407431 0.256888 0.008542 -0.432068 -0.011664 -0.020080 20220207 -0.050300 -0.052740 0.088085 0.341340 0.302589 -0.115876 0.125834 -0.125733 -0.033857 0.001599 20220208 0.039568 -0.105472 -0.121169 0.333338 -0.094310 0.110189 0.666552 -0.050896 0.050006 -0.056567 We will download these files from the ftp using ftp.get(), more about this function can be referred to in section 2.2. file.Rgn &lt;- &quot;EPFRHistory/Strategies/daily/MultiAsset-Rgn-daily.csv&quot; # PATH TO .csv FILE file.FI &lt;- &quot;EPFRHistory/Strategies/daily/MultiAsset-FI-daily.csv&quot; # PATH TO .csv FILE fldr &lt;- &quot;C:\\\\temp&quot; # LOCAL FOLDER ftp.get(file.Rgn, fldr, &quot;filetransport.epfrglobal.com&quot;, w = &quot;username&quot;, h = &quot;password&quot;, &quot;ftp&quot;) ftp.get(file.FI, fldr, &quot;filetransport.epfrglobal.com&quot;, w = &quot;username&quot;, h = &quot;password&quot;, &quot;ftp&quot;) # DOWNLOADS FILE FROM FTP TO LOCAL FOLDER, USING CREDENTIALS After downloading the csv files you will store both of the paths together as flow.file. A quick way to do this is shown below: flow.file.Rgn &lt;- paste(fldr, ftp.file(file.Rgn), sep = &quot;\\\\&quot;) # STORES FLOW FILE PATH, C:\\\\temp\\\\MultiAsset-Rgn-daily.csv flow.file.FI &lt;- paste(fldr, ftp.file(file.FI), sep = &quot;\\\\&quot;) # STORES FLOW FILE PATH, C:\\\\temp\\\\MultiAsset-FI-daily.csv flow.file &lt;- c(flow.file.Rgn, flow.file.FI) 5.2.4 Return File The return file for this strategy should contain daily returns for each of the asset classes in the flow file, which the user can find with their own resources. EPFR also provides Fund Return data, that can be used as a proxy to returns. To create a return file using EPFR daily flow data, the following equation can be used: \\[\\text{Fund Return}_{c,t} = \\frac{\\sum^{N}_{i=m} \\text{Portfolio Change}_i}{\\sum^{N}_{i=m} \\text{Assets Start}_i}\\] Where: \\(\\text{Fund Return}\\) = the return value of an asset class \\(c\\), across all funds \\(i\\), for day \\(t\\) For this demonstration, we will use files that have calculated returns using EPFR daily flow data, which has been locally named PsuedoReturns-Rgn.csv and PsuedoReturns-FI.csv. ret.file.Rgn &lt;- &quot;PsuedoReturns-Rgn.csv&quot; ret.file.FI &lt;- &quot;PsuedoReturns-FI.csv&quot; Example? Clean up return file here? 5.3 Strategy Implementation The final step implementing this strategy to create a signal. Lets begin by using the function multi.asset() from library('EPFR') to read the flow file to our R studio work space. This function simply compiles both data sets together. x &lt;- multi.asset(flow.file) # GET FLOW PERCENTAGE One of the first options we have is choosing the universe we want to use. EPFR has tested this signal within two different universes of asset classes Rgn (7 Region Equity) and F.I. (Fixed Income). For this example, we choose Multi, which includes both of our equity and fixed income asset classes. idx &lt;- &quot;Multi&quot; # Multi/Rgn/FI 5.3.1 Compounding Flows Next, we set up a variable for our look-back period, which can also be called a flow window. This variable will be the window of time we use to create a trailing compounded daily percentage flow. The look-back period we choose for our demonstrations is 20 days. lookback &lt;- 20 # FLOW WINDOW (IN WEEKDAYS) - 20 day look back period Again, using a function from the library('EPFR'), compound.flows() compounds the daily percentage flow over the trailing lookback period for each country. x &lt;- compound.flows(x, lookback, F) # COMPOUND FLOWS 5.3.2 Return file We will then import our two total return files and modify them to be one data frame of total index returns indexed so that time moves forward. To do this we will use function ret.to.idx() from library('EPFR') which will translate these returns to a total return index. We also use the functions map.rname() to ensure the row names of the matrices line up with our flow file and ret.idx.gaps.fix() to replace any NA values. #RGN RETURNS y &lt;- mat.read(ret.file.Rgn) y &lt;- ret.to.idx(map.rname(y, dimnames(x)[[1]])) # CONVERT TO A TOTAL-RETURN INDEX y &lt;- ret.idx.gaps.fix(y) #F.I. RETURNS z &lt;- mat.read(ret.file.FI) z &lt;- ret.to.idx(map.rname(z, dimnames(y)[[1]])) # CONVERT TO A TOTAL-RETURN INDEX #COMBINE RETURN FILES y &lt;- data.frame(y, z)[, dimnames(x)[[2]]] # FINAL TOTAL-RETURN INDEX TABLE y &lt;- y[max(simplify2array(lapply(y, function(x) {find.data(!is.na(x), T)}))):min(simplify2array(lapply(y, function(x) {find.data(!is.na(x), F)}))), ] # ENSURE ALL PIECES HAVE RETURN OVER THE SAME HORIZON Then, to subset the flow file \\(x\\) and return file \\(y\\) to the selected universe \\(idx\\) of asset classes, the function the following code is used. if (idx == &quot;Rgn&quot;) { x &lt;- x[, 1:7] y &lt;- y[, 1:7] } else if (idx == &quot;FI&quot;) { x &lt;- x[, 8:dim(x)[2]] y &lt;- y[, 8:dim(y)[2]] } else { z &lt;- map.rname(portfolio.beta.wrapper(y, &quot;ACWorld&quot;, lookback), dimnames(x)[[1]]) for (j in 1:dim(x)[1]) x[j, ] &lt;- portfolio.residual(unlist(x[j, ]), unlist(z[j, ])) } * Note: subsetting can be also be done when creating the flow and return files 5.3.3 Ranking Asset Classes Next, we sort the countries in each universe into five equal bins based on their 20-day Percentage Flow Compounded value for the selected holding period. To do this, we will use the function from library('EPFR'), called bbk(). This function will output a standardized backtest result. Th bbk() function requires our compounded daily percentage flow file, a return file, and our selected universe. Please refer to the library documentation for the complete list of parameters of this function. The first parameter we add is the number of bins we want to use. For our case, we want to use 5 because our strategy is to go long the top fifth and short the bottom fifth. nBin &lt;- 5 # NUMBER OF BINS Since EPFR data is published with T+1 day lag and is released around 5:00 pm EST, we account for a T+2 day delay in our model since that is when one can trade on the information. Users interested in more timely signals can also use the T+2 Open Prices for backtesting purposes. EPFR also offers a Premium Daily offering, an earlier release of the end-of-day data covering a significant subset of fund-level flow information. delay &lt;- 2 # DELAY IN KNOWING DATA (IN WEEKDAYS) - data takes time to have It is also important to note that this model will need to be re-balanced weekly. The day of the week the rebalancing occurs is at the discretion of the user. For this example we will set the day of the week to trade as Friday. doW &lt;- 5 # DAY OF THE WEEK YOU WILL TRADE ON (5 = FRIDAYS) Additionally, we also evaluate the returns for different holding periods. The user can input return horizions that they are interested in here. For this example we define a return horizon for weekly, fortnightly, monthly, bi-monthly, quarterly, and semi-annually. hz &lt;- c(5, 10, 20, 45, 65, 130) # RETURN HORIZON (IN WEEKDAYS) - holding periods Now that we have defined all of our inputs, to rank the countries into quintiles by their 20-day percentage flow, we call function bbk() for a 1-week holding period. z &lt;- bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay) 5.3.4 Model Twenty-day flow percentage ranked into quintiles (computed only where forward returns are available) z[[&quot;bins&quot;]] AsiaXJP EurXGB Japan LatAm PacXJP UK USA GLOBEM WESEUR HYIELD FLOATS USTRIN USTRLT USTRST CASH USMUNI GLOFIX Quintile Returns over the equal-weight universe z[[&quot;rets&quot;]] Q1 Q2 Q3 Q4 Q5 TxB uRet 5.3.5 Performance Performance over all holding periods fcn &lt;- function(retW) {as.matrix(bbk(x, y, 1, retW, 5, doW, T, 0, delay)$summ)} # DEFINE SUMMARY FUNCTION mat.ex.array3d(sapply(split(hz, hz), fcn, simplify = &quot;array&quot;)) # WRITE SUMMARIES Q1 Q2 Q3 Q4 Q5 TxB uRet Bi-Monthly AnnMn 4.934705e-01 9.371790e-02 5.491154e-01 -5.653198e-01 -4.137834e-01 9.072539e-01 3.414070e+00 AnnSd 6.038767e+00 5.483679e+00 5.432645e+00 5.158366e+00 5.691456e+00 8.329876e+00 9.178851e+00 Sharpe 7.627058e+00 9.114961e-01 1.218932e+01 -8.857571e+00 -7.661794e+00 1.108401e+01 3.734956e+01 HitRate -3.280423e+00 4.061625e-01 2.220666e+00 -3.804855e+00 -7.085279e+00 2.888266e+00 1.509804e+01 Beta -2.407894e-01 1.617299e-01 1.155227e-01 7.913080e-02 -1.958810e-01 -4.490840e-02 1.000000e+00 Alpha 1.321712e+00 -4.485749e-01 1.605881e-01 -8.478605e-01 2.462806e-01 1.075431e+00 0.000000e+00 DrawDn -2.379111e+01 -1.999374e+01 -1.951135e+01 -2.764960e+01 -2.243145e+01 -3.053523e+01 -3.101945e+01 DDnBeg 2.011626e+07 2.011611e+07 2.010418e+07 2.007845e+07 2.009500e+07 2.011724e+07 2.007096e+07 DDnN 4.022222e+01 3.588889e+01 1.866667e+01 3.744444e+01 3.900000e+01 4.311111e+01 7.666667e+00 AnnTo 4.148592e+02 4.156864e+02 4.614113e+02 4.158705e+02 4.263875e+02 8.412467e+02 0.000000e+00 Fortnightly AnnMn 5.141872e-01 3.998400e-01 2.951020e-02 -7.768919e-01 -4.096160e-02 5.551488e-01 3.426943e+00 AnnSd 6.078440e+00 5.198346e+00 5.489896e+00 4.944432e+00 5.623593e+00 8.561354e+00 8.320958e+00 Sharpe 8.721543e+00 7.663163e+00 5.489311e-01 -1.554001e+01 -9.283209e-01 6.601432e+00 4.119830e+01 HitRate -9.186352e-01 2.099737e+00 2.099737e+00 -2.230971e+00 -1.443570e+00 1.706037e+00 1.233596e+01 Beta -2.013120e-01 2.049004e-01 2.327309e-01 -1.865370e-02 -2.797479e-01 7.843590e-02 1.000000e+00 Alpha 1.192476e+00 -3.003186e-01 -7.693437e-01 -7.117015e-01 9.262279e-01 2.662479e-01 0.000000e+00 DrawDn -2.413886e+01 -1.591318e+01 -2.563660e+01 -2.554373e+01 -2.250888e+01 -3.576139e+01 -3.576917e+01 DDnBeg 2.012061e+07 2.014572e+07 2.007542e+07 2.007087e+07 2.009036e+07 2.011052e+07 2.007106e+07 DDnN 1.915000e+02 1.050000e+02 6.000000e+01 1.830000e+02 1.815000e+02 2.045000e+02 3.150000e+01 AnnTo 1.798333e+03 1.873026e+03 2.072018e+03 1.882434e+03 1.872456e+03 3.670789e+03 0.000000e+00 Monthly AnnMn 8.592623e-01 4.663268e-01 1.331860e-02 -1.102298e+00 -2.461950e-02 8.838818e-01 3.443160e+00 AnnSd 5.732488e+00 5.185376e+00 5.374702e+00 5.066755e+00 5.771958e+00 8.111981e+00 8.803569e+00 Sharpe 1.470256e+01 8.704316e+00 2.350253e-01 -2.331718e+01 -4.651670e-01 1.078672e+01 3.914899e+01 HitRate 1.253789e-01 1.186277e+00 -1.253789e-01 -3.289474e+00 -5.905208e+00 3.415541e+00 1.194682e+01 Beta -2.143911e-01 1.759100e-01 2.126023e-01 2.922530e-02 -2.717250e-01 5.733390e-02 1.000000e+00 Alpha 1.594307e+00 -1.305919e-01 -7.239893e-01 -1.206146e+00 9.119993e-01 6.823080e-01 0.000000e+00 DrawDn -2.211749e+01 -1.755338e+01 -2.341990e+01 -3.304944e+01 -1.962549e+01 -3.283320e+01 -3.389934e+01 DDnBeg 2.013557e+07 2.015561e+07 2.008569e+07 2.007567e+07 2.008574e+07 2.011332e+07 2.007104e+07 DDnN 5.925000e+01 5.325000e+01 8.050000e+01 1.142500e+02 9.275000e+01 7.975000e+01 1.675000e+01 AnnTo 9.181122e+02 9.441268e+02 1.025070e+03 9.458668e+02 9.558644e+02 1.873977e+03 0.000000e+00 Quarterly AnnMn 3.295929e-01 4.152660e-01 7.154109e-01 -7.292608e-01 -6.263440e-01 9.559369e-01 3.451610e+00 AnnSd 5.794036e+00 5.301457e+00 5.132181e+00 5.188782e+00 5.724617e+00 8.131716e+00 9.179433e+00 Sharpe 6.154272e+00 9.435514e+00 1.401781e+01 -1.377800e+01 -1.092749e+01 1.267380e+01 3.767121e+01 HitRate -3.290923e+00 1.054264e+00 1.715146e+00 -4.324956e+00 -2.740188e+00 1.942184e+00 1.746167e+01 Beta -2.369065e-01 1.636358e-01 8.158010e-02 1.080071e-01 -2.068641e-01 -3.004240e-02 1.000000e+00 Alpha 1.135097e+00 -1.370291e-01 4.521481e-01 -1.106061e+00 7.020840e-02 1.064889e+00 0.000000e+00 DrawDn -2.704203e+01 -1.920558e+01 -2.239518e+01 -2.713270e+01 -2.511779e+01 -3.025123e+01 -2.855401e+01 DDnBeg 2.010762e+07 2.010603e+07 2.010535e+07 2.009227e+07 2.010698e+07 2.010221e+07 2.007107e+07 DDnN 3.515385e+01 2.384615e+01 1.338462e+01 2.884615e+01 3.238462e+01 2.915385e+01 4.692308e+00 AnnTo 2.840802e+02 2.937503e+02 3.197109e+02 2.923635e+02 2.962539e+02 5.803341e+02 0.000000e+00 Semi-Annual AnnMn -2.066210e-02 1.276884e-01 5.146328e-01 -2.292361e-01 -3.585738e-01 3.379117e-01 3.264504e+00 AnnSd 5.822752e+00 5.376476e+00 5.347787e+00 5.229883e+00 6.130645e+00 8.255394e+00 9.887262e+00 Sharpe -1.655782e-01 3.306547e+00 1.004748e+01 -5.699820e+00 -7.793136e+00 4.201010e+00 3.310566e+01 HitRate -4.580018e+00 1.856764e+00 3.541114e+00 -1.198055e+00 -5.800177e+00 1.547303e-01 1.798851e+01 Beta -2.242735e-01 1.342617e-01 1.036034e-01 1.510856e-01 -2.597929e-01 3.551940e-02 1.000000e+00 Alpha 6.974777e-01 -3.053511e-01 1.878828e-01 -7.064477e-01 4.637045e-01 2.337731e-01 0.000000e+00 DrawDn -2.541962e+01 -1.940877e+01 -1.932164e+01 -2.102064e+01 -2.470467e+01 -3.157175e+01 -2.575678e+01 DDnBeg 2.010609e+07 2.010686e+07 2.010299e+07 2.009335e+07 2.009459e+07 2.010918e+07 2.007133e+07 DDnN 1.703846e+01 1.323077e+01 8.884615e+00 1.184615e+01 1.607692e+01 1.396154e+01 2.500000e+00 AnnTo 1.463938e+02 1.482309e+02 1.584944e+02 1.500237e+02 1.469496e+02 2.933434e+02 0.000000e+00 Weekly AnnMn 2.372581e+00 6.815386e-01 -8.791404e-01 -2.389582e-01 -2.078578e+00 4.451159e+00 3.476831e+00 AnnSd 6.260578e+00 5.326132e+00 5.469632e+00 4.857803e+00 5.295975e+00 8.598031e+00 8.039942e+00 Sharpe 3.789715e+01 1.279613e+01 -1.607312e+01 -4.919058e+00 -3.924826e+01 5.176952e+01 4.324447e+01 HitRate 6.561680e-01 1.837270e+00 2.624672e-01 -1.837270e+00 -3.280840e+00 4.593176e+00 7.874016e+00 Beta -2.393223e-01 1.297566e-01 1.945765e-01 1.248160e-02 -1.449182e-01 -9.440410e-02 1.000000e+00 Alpha 3.204664e+00 2.303969e-01 -1.555650e+00 -2.823546e-01 -1.574722e+00 4.779386e+00 0.000000e+00 DrawDn -2.578518e+01 -1.187249e+01 -3.145387e+01 -2.879276e+01 -4.591276e+01 -1.665329e+01 -3.582700e+01 DDnBeg 2.010070e+07 2.015063e+07 2.007062e+07 2.007113e+07 2.009023e+07 2.015031e+07 2.007103e+07 DDnN 3.670000e+02 1.840000e+02 1.080000e+02 3.590000e+02 6.610000e+02 7.200000e+01 5.600000e+01 AnnTo 3.519054e+03 3.734297e+03 4.101007e+03 3.683049e+03 3.664827e+03 7.183881e+03 0.000000e+00 Annualized mean one-week returns bbk(x, y, 1, hz[1], 5, doW, T, 0, delay)$annSumm # DISPLAY CALENDAR-YEAR RETURNS Q1 Q2 Q3 Q4 Q5 TxB uRet nPrds 2007 -2.4122844 -2.9281361 0.7414669 7.2192330 -3.9200625 1.5077781 4.083357 29 2008 29.1522240 -4.6785452 -22.0729442 -11.1138780 13.9772844 15.1749396 -27.417418 52 2009 6.4124890 1.1163040 -3.1291277 -1.2997502 -3.0387662 9.4512552 24.141740 52 2010 5.7183550 7.6806292 3.4536324 -1.6937395 -17.1545069 22.8728619 9.964876 53 2011 -10.3604197 4.3103565 10.6435884 -2.4120009 -2.8143096 -7.5461101 -2.537112 52 2012 -1.1367680 -0.7117367 2.0261140 1.2976442 -1.6705560 0.5337881 9.883816 52 2013 2.6279524 4.7064922 6.3791526 -7.6044317 -5.1431857 7.7711381 4.569832 52 2014 2.1802066 5.4420210 -8.2037308 -3.0747093 2.8671087 -0.6869021 4.051446 52 2015 -1.4005917 -5.7200547 4.7768224 6.2858051 -4.1305645 2.7299728 -1.968191 52 2016 -7.4249604 2.6231142 0.3093421 1.2888183 1.8997082 -9.3246686 5.941342 53 2017 -0.8577682 1.6320792 3.7327545 -0.6461399 -4.1895722 3.3318040 8.457597 52 2018 4.6698097 -8.1107388 -6.2823623 8.9437148 0.5019179 4.1678918 -6.120206 52 2019 3.5749133 3.6099025 -3.7295227 -3.4221217 -0.0957650 3.6706782 11.606858 52 2020 -2.0794748 -1.2686212 -0.2701569 4.3393082 -1.7446176 -0.3348573 5.327833 52 2021 4.3972934 1.6127993 -0.5310650 0.5268859 -6.7191421 11.1164355 3.660437 53 2022 15.2813277 -22.1781233 -11.9846421 27.4165416 -10.2812434 25.5625711 -32.953700 2 "],["fx-strategy.html", "6 FX Strategy 6.1 Overview 6.2 Daily Percentage Flow 6.3 Strategy Implementation", " 6 FX Strategy 6.1 Overview The FX Strategy an equity based currency rotation strategy, which ranks different foreign exchange markets of countries across a customized universe of both developed and emerging markets. This approach uses the stated allocations of equity funds with a cross-border focus and calculates percentage flow into currencies. In terms of twenty-day percentage flows, the top fifth of ACWI currencies outperform the bottom fifth by over 4% per year. The strategy works best amongst G10 currencies, but adds value across the board. 6.2 Daily Percentage Flow The FX Strategy developed by EPFR Global is based on percentage flow into currencies. In this section, the reader will gain an understanding of the aggregations which can be used to create a signal as well as the methodology behind daily percentage flow calculations. 6.2.1 Aggregations The first step is defining a subset of data to capture in calculating our signal. This strategy requires; Equity funds with a cross-boarder focus. These are essentially any fund that has a mandate spanning more than one country. The vast majority of these will be global and regional funds. Funds must report both daily flows and country allocations, since these values are needed to calculate Daily Percentage Flow. Cross-border equity funds, which report their country allocations and their fund flows, are a subset of those that only report their fund flows to EPFR. The figure below shows EPFRs coverage of this universe over time compared to our total coverage. Updated at the end of July each year Users looking for more specific detail can customize this aggregation even further using EPFRs fund-level or share class-level granularity. Some good examples would be Active/Passive, ETF or Mutual funds, Institutional or Retail. Users can use these tags to different degrees in creating aggregated signals to backtest. Further detail about this is available in section 3. This can be achieved using fund-level flow files or reaching out to EPFRs quant team for customized aggregations. 6.2.2 Calculation To begin calculating the Daily Percentage flow, we start with our subset of cross-border equity funds. To calculate the funds impact on a currency, we scale a funds flow by multiplying it against its stated country allocation to countries using that currency, which is available in EPFRs Country Allocation Database, on that day. EPFR releases country allocations of all funds on the \\(23^{\\text{rd}}\\) of each month (or the next available business day) at a monthly frequency. Hence, our calculation assumes constant country allocation between two consecutive release dates within the month. We then apply the same procedure to all funds with a fund flow and country allocation information and then sum the flows for each currency across all funds. \\[\\text{Total Impact}_{c,t} = \\sum^{N}_{i=m}{\\text{Flow}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total Impact}\\) = the impact on a currency \\(c\\), across all funds \\(i\\), for day \\(t\\) Additionally, we repeat the process across the same funds Assets held under Management (AuM), to get the total AuM held in a country. \\[\\text{Total AuM}_{c,t} = \\sum^{N}_{i=m}{\\text{AuM}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total AuM}\\) = the assets held in a currency \\(c\\), across all funds \\(i\\), for day \\(t\\) Finally, to find the daily percentage flow into a currency, we divide the Total Impact by the Total AuM. Then we repeat this across all different currencies for the entire history. \\[\\text{Percentage Flow}_{c,t} = \\frac{\\text{Total Impact}_{c,t}}{\\text{Total AuM}_{c,t}}\\] Where: \\(\\text{Percentage Flow}\\) = the scaled flow as a percentage into a currency \\(c\\), across all funds \\(i\\), for day \\(t\\) 6.2.3 Flow File The users may create flow percentages for their desired FX aggregations and granularity using the methodology described in the previous section. EPFR also provides a pre-calculated aggregation for its users for the FX Strategy. This file can be found on the FTP under the strategies folder. Please refer to the FTP Folder Structure section for the exact location of this file. This file contains daily flow data for 37 currencies and is updated daily at 5:00 PM est. with a T+1 day lag. For this demonstration, we use the pre-calculated file FX-daily.csv. Below shows a snippet of what this file contains. ARS AUD BRL CAD CHF CLP CNY CZK EGP GBP HUF IDR ILS INR JPY KRW MXN MYR NOK NZD PEN PHP PLN RUB SEK SGD THB TRY TWD ZAR USD EUR COP PKR MAD VND KWD 20211201 0.0582952 0.0642510 -0.1627513 -0.2095672 -0.0569435 -0.3364008 0.0262548 0.0359206 -0.0071103 -0.1312920 -0.0016187 -0.0744074 0.0372747 0.0007230 -0.1285083 -0.0803595 -0.3496337 -0.1279190 -0.0881510 0.0964151 -0.4728823 -0.0312319 0.0584874 0.0044415 -0.0822945 -0.1075249 -0.1667413 -0.0780462 -0.0404629 -0.0059069 -0.3996720 -0.0619681 -0.9142540 -0.0348103 -0.0468367 -0.2449427 0.0086954 20211202 0.1427932 0.1174890 0.1277876 0.3190712 0.0677975 0.2395956 -0.0115445 -0.0042393 -0.0266620 0.1206749 -0.1281484 0.0121958 0.0429041 0.0002694 0.2162832 0.0912649 0.2647911 0.0929547 0.1513227 0.0940902 0.4308823 -0.0087971 0.0300832 -0.0224445 0.1260475 0.1208164 0.1004913 0.0289090 0.0216235 -0.0068367 0.2317123 0.0742995 0.7351434 -0.0404067 0.1093668 -0.0274455 0.0045501 20211203 0.0808346 0.0259152 0.0108116 0.0444888 -0.0008535 0.0106680 0.0449640 0.0110304 0.0305939 -0.0085637 -0.0431586 0.0352636 -0.0022655 0.0345916 0.0237522 -0.0123201 0.0078203 0.0929255 0.0173334 0.0435219 -0.0416571 0.0609344 -0.0367286 0.0235493 -0.0090282 0.0501322 0.0677739 -0.0033249 0.0313737 0.0667056 0.1368416 -0.0210397 -0.0143633 0.1140145 0.0000363 -0.0724359 0.0528569 20211206 0.0864210 0.0332991 0.0339350 0.0293505 -0.0087805 0.0165279 0.0435768 -0.0254415 -0.0197045 -0.0393558 -0.0236676 0.0051224 0.0209603 0.0562829 -0.0236927 0.0711985 0.0571279 0.0618109 0.0042814 0.0422995 0.0267913 0.0402620 0.0215237 0.0426562 -0.0152616 0.0281240 0.1387422 0.0085348 0.0661176 0.0554000 0.0049791 -0.0195911 -0.0204257 0.0743194 -0.5029119 -0.0201544 0.0134144 20211207 0.1008291 0.0166885 -0.0296141 -0.0274670 -0.0469534 -0.0267527 -0.0090559 0.0216185 -0.0152775 -0.0776130 -0.0438097 -0.0158515 -0.0138826 -0.0232481 -0.0761700 -0.0292027 -0.0506360 0.0008120 -0.0060814 0.0322974 -0.0428475 -0.0158337 -0.0391469 -0.0607845 -0.0041353 0.0162118 -0.0223686 -0.1052633 -0.0407479 -0.0423933 -0.0153973 -0.0418070 -0.0125725 -0.0008045 -0.0222931 0.0027853 -0.0158550 20211208 0.0058332 -0.0012981 -0.0536485 0.0074002 0.0558389 -0.0353495 0.0093973 -0.0468938 -0.0184083 0.0524607 -0.0761173 -0.0219408 0.0140936 -0.0344472 -0.0009602 -0.0230243 -0.0388162 -0.0370424 0.0331924 0.0092934 0.0662358 -0.0801304 -0.0917914 -0.1301750 0.0345979 0.0016398 -0.0478852 -0.1055680 -0.0330652 -0.0646916 0.0829087 0.0091279 -0.1036020 0.1057587 0.0934492 -0.3207882 -0.0492813 We will download this file from the ftp using ftp.get(), more about this function can be referred to in section 2.2. file &lt;- &quot;EPFRHistory/Strategies/daily/FX-daily.csv&quot; # PATH TO .csv FILE fldr &lt;- &quot;C:\\\\temp&quot; # LOCAL FOLDER ftp.get(file, fldr, &quot;filetransport.epfrglobal.com&quot;, w = &quot;username&quot;, h = &quot;password&quot;, &quot;ftp&quot;) # DOWNLOADS FILE FROM FTP TO LOCAL FOLDER, USING CREDENTIALS After downloading the csv file you will store its path as flow.file. A quick way to do this is shown below: flow.file &lt;- paste(fldr, ftp.file(file), sep = &quot;\\\\&quot;) # STORES FLOW FILE PATH, C:\\\\temp\\\\FX-daily.csv 6.2.4 Return File The return file for this strategy should contain daily Exchange rates for each of the currencies in the flow file, which the user can find with their own resources. For this demonstration, we will the file which has been locally named ExchRates.csv. ret.file &lt;- &quot;ExchRates.csv&quot; For your reference a snippet of our return file looks like this XDR AUD EGP INR MXN NZD QAR TRY ZAR ARS BRL EUR IDR KRW NOK PHP SEK CAD CHF CLP HUF JPY PEN RUB TWD CNY CZK GBP ILS MYR PLN SGD THB JOR PKR MAD COP CNH VND KWD 20211201 1.39950 1.4073 15.7019 74.9075 21.5099 1.4685 3.6416 13.2480 16.0377 101.0112 5.6808 0.8834 14343 1179.1 9.0563 50.365 9.0822 1.2818 0.9200 838.80 320.51 112.78 4.0710 74.2650 27.762 6.3681 22.5043 0.7533 3.1654 4.2195 4.0841 1.3652 33.728 NA 175.2884 9.2331 3971.56 6.3721 22710 0.30245 20211202 1.40051 1.4099 15.7025 74.9913 21.2649 1.4668 3.6416 13.6831 15.9359 101.0872 5.6393 0.8849 14378 1176.5 9.0928 50.410 9.0526 1.2810 0.9203 837.80 322.39 113.11 4.0705 73.6620 27.753 6.3771 22.5148 0.7517 3.1607 4.2320 4.0692 1.3694 33.870 NA 175.7613 9.2222 3938.27 6.3729 22723 0.30245 20211203 1.39858 1.4290 15.7025 75.1687 21.2743 1.4820 3.6416 13.7030 16.0809 101.1600 5.6527 0.8840 14398 1179.9 9.1767 50.387 9.1437 1.2843 0.9172 841.25 321.97 112.80 4.0770 73.8889 27.714 6.3765 22.4717 0.7556 3.1666 4.2308 4.0639 1.3717 33.890 NA 175.7613 9.2196 3967.44 6.3748 22792 0.30245 20211206 1.39799 1.4181 15.7021 75.4238 21.2247 1.4806 3.6416 13.8047 15.9187 101.2950 5.6860 0.8861 14438 1182.6 9.0913 50.417 9.0961 1.2756 0.9254 846.53 324.14 113.48 4.0855 74.3795 27.741 6.3763 22.5296 0.7539 3.1622 4.2327 4.0706 1.3687 33.890 NA 176.2889 9.2118 3932.17 6.3748 23064 0.30255 20211207 1.39623 1.4046 15.7021 75.4312 21.0355 1.4725 3.6416 13.4914 15.8505 101.4200 5.6097 0.8875 14378 1179.7 9.0188 50.375 9.1022 1.2639 0.9254 839.28 325.72 113.60 4.0785 74.0668 27.774 6.3663 22.5886 0.7551 3.1322 4.2323 4.0674 1.3664 33.688 NA 176.3839 9.2232 3910.65 6.3640 23093 0.30255 20211208 1.39717 1.3943 15.7027 75.4550 20.9335 1.4686 3.6416 13.6765 15.7146 101.4200 5.5301 0.8817 14358 1175.9 8.8805 50.375 9.0404 1.2654 0.9206 840.95 321.73 113.67 4.0785 73.5979 27.741 6.3442 22.4483 0.7573 3.0999 4.2248 4.0657 1.3617 33.478 NA 177.1267 9.1981 3905.56 6.3459 22992 0.30255 6.3 Strategy Implementation The final step is implementing this strategy to create a signal. Lets begin by reading in the flow and return files to our R studio work space. x &lt;- mat.read(flow.file) # GET FLOW PERCENTAGE y &lt;- 1/mat.read(ret.file) # READ IN EXCHANGE RATES One of our first options is choosing the universe we want to use. EPFR has tested this signal within three different universes of countries ACWI (All Country World Index), G10 (ten of the most heavily traded currencies), EM (Emerging Markets). For this example, we choose ACWI, which includes 52 countries and 37 currencies. idx &lt;- &quot;ACWI&quot; # ACWI/G10/EM If needed, subset the flow file \\(x\\) and return file \\(y\\) to the selected universe \\(idx\\). For this example, our flow file is already in the ACWI universe but below is an example of how we set this using the functions Ctry.msci.members.rng() and Ctry.info(), from the library('EPFR') is used. This function first returns a list of two letter country codes from \\(idx\\) and then will produce a unique list of three letter currency codes that these countries use. idx.curr &lt;- unique(Ctry.info(Ctry.msci.members(idx, &quot;&quot;), &quot;Curr&quot;)) # CURRENCY CLASSIFICATION 2016 if (idx != &quot;G10&quot;) idx.curr &lt;- union(Ctry.info(Ctry.msci(idx)[, &quot;CCODE&quot;], &quot;Curr&quot;), idx.curr) else idx &lt;- NULL # CAPTURE INDEX CHANGES if (is.element(&quot;EM&quot;, idx)) idx.curr &lt;- setdiff(idx.curr, c(&quot;USD&quot;, &quot;EUR&quot;)) # ENSURE NO OVERLAP BETWEEN DEVELOPED AND EM CURRENCIES x &lt;- x[, is.element(dimnames(x)[[2]], idx.curr)] # SUBSET TO CURRENCIES OF INTEREST We will also subset the return file \\(y\\) to use the same currencies as \\(x\\). Divide by XDR? y &lt;- y[, dimnames(x)[[2]]]/y[, &quot;XDR&quot;] # CURRENCIES OF INTEREST ON AN SDR BASE (OTHERWISE &lt;get.fwdRet&gt; THINKS THE USD NEVER TRADES!) * Note: subsetting can be also be done when creating the flow and return files 6.3.1 Compounding Flows Next, we set up a variable for our look-back period, which can also be called a flow window. This variable will be the window of time we use to create a trailing compounded daily percentage flow. The look-back period we choose for our demonstrations is 20 days. lookback &lt;- 20 # FLOW WINDOW (IN WEEKDAYS) - 20 day look back period Again, using a function from the library('EPFR'), compound.flows() compounds the daily percentage flow over the trailing lookback period for each country. x &lt;- compound.flows(x, lookback, F) # COMPOUND FLOWS 6.3.2 Ranking Currencies Next, we sort the currencies in each universe into five equal bins based on their 20-day Percentage Flow Compounded value for the selected holding period. To do this, we will use the function from library('EPFR'), called bbk(). This function will output a standardized backtest result. Th bbk() function requires our compounded daily percentage flow file, a return file, and our selected universe. Please refer to the library documentation for the complete list of parameters of this function. The first parameter we add is the number of bins we want to use. For our case, we want to use 5 because our strategy is to go long the top fifth and short the bottom fifth. nBin &lt;- 5 # NUMBER OF BINS Since EPFR data is published with T+1 day lag and is released around 5:00 pm EST, we account for a T+2 day delay in our model since that is when one can trade on the information. Users interested in more timely signals can also use the T+2 Open Prices for backtesting purposes. EPFR also offers a Premium Daily offering, an earlier release of the end-of-day data covering a significant subset of fund-level flow information. delay &lt;- 2 # DELAY IN KNOWING DATA (IN WEEKDAYS) - data takes time to have It is also important to note that this model will need to be re-balanced weekly. The day of the week the rebalancing occurs is at the discretion of the user. For this example we will set the day of the week to trade as Friday. doW &lt;- 5 # DAY OF THE WEEK YOU WILL TRADE ON (5 = FRIDAYS) Additionally, we also evaluate the returns for different holding periods. The user can input return horizions that they are interested in here. For this example we define a return horizon for weekly, fortnightly, monthly, bi-monthly, quarterly, and semi-annually. hz &lt;- c(5, 10, 20, 45, 65, 130) # RETURN HORIZON (IN WEEKDAYS) - holding periods Now that we have defined all of our inputs, to rank the currencies into quintiles by their 20-day percentage flow, we call function bbk() for a 1-week holding period. z &lt;- bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay, idx) 6.3.3 Model Twenty-day flow percentage ranked into quintiles (computed only where forward returns are available) z[[&quot;bins&quot;]] ARS AUD BRL CAD CHF CLP CNY CZK EGP GBP HUF IDR ILS INR JPY KRW MXN MYR NOK NZD PEN PHP PLN RUB SEK SGD THB TRY TWD ZAR USD EUR COP PKR MAD VND KWD 20211231 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA 20211224 NA 1 4 2 1 2 3 3 NA 1 5 4 5 4 2 3 4 3 1 1 4 5 5 5 1 2 3 5 3 4 NA 2 2 NA NA NA NA 20211217 NA 1 4 1 3 3 4 3 3 4 5 5 1 4 2 4 5 1 2 1 5 2 3 5 3 2 2 2 5 4 1 3 5 NA NA NA 1 20211210 NA 3 4 2 1 3 2 4 3 1 5 3 1 3 2 3 4 4 1 2 1 5 5 5 1 2 4 5 3 5 1 2 5 NA NA NA 4 20211203 NA 1 4 5 3 5 1 1 2 4 2 3 1 2 4 3 5 4 4 1 5 2 1 2 3 4 5 3 3 2 5 3 5 NA NA NA 1 Quintile Returns over the equal-weight universe z[[&quot;rets&quot;]] Q1 Q2 Q3 Q4 Q5 TxB uRet 20211231 NA NA NA NA NA NA NaN 20211224 1.0344582 0.6202132 0.7369220 0.5656810 -2.9572743 3.9917325 -0.3864387 20211217 -1.6348104 7.2168172 -1.9055198 -1.3265811 -1.5084436 -0.1263667 2.1800218 20211210 0.4821801 0.3009638 0.6729046 0.6981413 -2.0114606 2.4936408 -0.6941644 20211203 0.2713378 -0.4195049 -0.5370913 0.2294279 0.4286765 -0.1573386 0.2504150 6.3.4 Performance Performance over all holding periods fcn &lt;- function(retW) {as.matrix(bbk(x, y, 1, retW, 5, doW, T, 0, delay, idx)$summ)} # DEFINE SUMMARY FUNCTION t(mat.ex.array(sapply(split(hz, hz), fcn, simplify = &quot;array&quot;))) # WRITE SUMMARIES Q1 Q2 Q3 Q4 Q5 TxB uRet Bi-Monthly AnnMn 3.659518e-01 4.261550e-02 1.029430e-01 -4.731490e-02 -4.479541e-01 8.139059e-01 -2.244316e+00 AnnSd 3.269173e+00 2.870747e+00 2.944263e+00 3.081608e+00 3.450197e+00 5.666856e+00 1.087973e+01 Sharpe 1.244038e+01 1.670734e+00 4.418545e+00 -1.376680e+00 -1.311764e+01 1.504197e+01 -2.071072e+01 HitRate 2.640834e+00 2.357610e+00 1.988795e+00 1.847183e+00 -2.707750e-01 1.976346e+00 -2.113290e+00 Beta -4.504540e-02 -3.077880e-02 -3.884060e-02 3.417070e-02 8.152680e-02 -1.265721e-01 1.000000e+00 Alpha 2.621562e-01 -2.807460e-02 1.733410e-02 3.017190e-02 -2.631299e-01 5.252861e-01 0.000000e+00 DrawDn -1.236127e+01 -1.049253e+01 -1.279761e+01 -1.385315e+01 -1.820612e+01 -2.223186e+01 -5.788302e+01 DDnBeg 2.013302e+07 2.010939e+07 2.010846e+07 2.010954e+07 2.009822e+07 2.012294e+07 2.011062e+07 DDnN 2.077778e+01 3.333333e+01 3.233333e+01 3.655556e+01 4.855556e+01 2.733333e+01 5.122222e+01 AnnTo 4.139082e+02 4.544748e+02 4.433571e+02 4.482824e+02 4.260119e+02 8.399201e+02 0.000000e+00 Fortnightly AnnMn 3.228152e-01 4.711120e-01 4.441306e-01 -5.324450e-02 -1.132851e+00 1.455666e+00 -2.351059e+00 AnnSd 3.428686e+00 3.018408e+00 3.259224e+00 3.095792e+00 3.559849e+00 5.850413e+00 9.989152e+00 Sharpe 9.464187e+00 1.605952e+01 1.365886e+01 -1.860001e+00 -3.339792e+01 2.507405e+01 -2.354025e+01 HitRate -3.280795e-01 4.579443e-01 4.593113e-01 1.236791e+00 -2.805763e+00 2.938362e+00 -3.277378e-01 Beta 2.862000e-04 -3.186500e-03 -4.496780e-02 -3.289300e-03 5.103720e-02 -5.075100e-02 1.000000e+00 Alpha 3.238001e-01 4.638544e-01 3.383386e-01 -6.119330e-02 -1.013049e+00 1.336849e+00 0.000000e+00 DrawDn -1.161437e+01 -7.098433e+00 -9.674186e+00 -1.607684e+01 -2.783884e+01 -1.661634e+01 -6.085436e+01 DDnBeg 2.019562e+07 2.012562e+07 2.013081e+07 2.009601e+07 2.011080e+07 2.017567e+07 2.011058e+07 DDnN 3.900000e+01 3.200000e+01 1.300000e+02 2.125000e+02 2.390000e+02 3.700000e+01 2.300000e+02 AnnTo 1.800094e+03 2.014802e+03 1.991776e+03 2.029122e+03 1.844908e+03 3.645002e+03 0.000000e+00 Monthly AnnMn 9.109228e-01 1.634903e-01 1.227630e-02 -3.123483e-01 -7.733168e-01 1.684240e+00 -2.357752e+00 AnnSd 3.483450e+00 2.870210e+00 3.179843e+00 3.358640e+00 3.301151e+00 5.646567e+00 1.034825e+01 Sharpe 2.770431e+01 6.641630e+00 2.173767e-01 -9.320418e+00 -2.407100e+01 3.112093e+01 -2.280232e+01 HitRate 4.517085e+00 1.242078e+00 5.931386e-01 1.956462e-01 -1.762882e+00 5.431937e+00 -1.640259e+00 Beta -1.744710e-02 -1.599650e-02 -3.851500e-02 8.386800e-03 6.323350e-02 -8.068060e-02 1.000000e+00 Alpha 8.704199e-01 1.251400e-01 -7.884870e-02 -2.907842e-01 -6.254477e-01 1.495867e+00 0.000000e+00 DrawDn -1.019128e+01 -1.083900e+01 -1.268465e+01 -2.059624e+01 -2.064839e+01 -1.654785e+01 -5.962323e+01 DDnBeg 2.017344e+07 2.010562e+07 2.014559e+07 2.008819e+07 2.010326e+07 2.011572e+07 2.011055e+07 DDnN 2.750000e+01 2.125000e+01 5.300000e+01 1.072500e+02 1.247500e+02 4.250000e+01 1.157500e+02 AnnTo 9.065563e+02 1.000787e+03 1.004002e+03 1.008091e+03 9.374313e+02 1.843988e+03 0.000000e+00 Quarterly AnnMn 5.133031e-01 3.305175e-01 -4.117000e-02 -2.530197e-01 -5.408357e-01 1.054139e+00 -2.208900e+00 AnnSd 3.196699e+00 2.845606e+00 3.051886e+00 2.999375e+00 3.347713e+00 5.446590e+00 1.106813e+01 Sharpe 1.681142e+01 1.117917e+01 -1.692233e+00 -6.812789e+00 -1.591663e+01 1.951696e+01 -2.003489e+01 HitRate 5.305040e+00 2.519894e+00 1.724138e+00 9.283820e-01 -1.856764e+00 4.641910e+00 -5.172414e+00 Beta -2.785050e-02 -3.877500e-02 -3.950180e-02 3.315330e-02 7.606810e-02 -1.039186e-01 1.000000e+00 Alpha 4.532385e-01 2.437019e-01 -1.255514e-01 -1.815748e-01 -3.735467e-01 8.267852e-01 0.000000e+00 DrawDn -9.948877e+00 -9.580469e+00 -1.206465e+01 -1.461782e+01 -2.037046e+01 -1.769754e+01 -5.611454e+01 DDnBeg 2.012209e+07 2.010906e+07 2.011376e+07 2.008459e+07 2.010835e+07 2.012141e+07 2.010832e+07 DDnN 1.661538e+01 1.576923e+01 2.515385e+01 3.315385e+01 2.900000e+01 1.776923e+01 3.692308e+01 AnnTo 2.924214e+02 3.201718e+02 3.135657e+02 3.184919e+02 3.004042e+02 5.928256e+02 0.000000e+00 Semi-Annual AnnMn 4.322030e-01 4.633787e-01 -9.155060e-02 -2.324240e-01 -5.588495e-01 9.910525e-01 -2.148353e+00 AnnSd 3.173137e+00 2.763453e+00 2.997886e+00 2.909363e+00 3.393845e+00 5.399690e+00 1.169062e+01 Sharpe 1.493992e+01 1.740971e+01 -3.759073e+00 -7.333405e+00 -1.658202e+01 1.852100e+01 -1.851764e+01 HitRate 6.380258e+00 4.215612e+00 1.534672e+00 -9.236453e-01 -3.078818e+00 7.275483e+00 -6.721296e+00 Beta -2.784240e-02 -4.348010e-02 -3.591450e-02 1.514510e-02 9.542740e-02 -1.232698e-01 1.000000e+00 Alpha 3.733726e-01 3.669320e-01 -1.646337e-01 -1.997245e-01 -3.557899e-01 7.291625e-01 0.000000e+00 DrawDn -9.919553e+00 -7.897396e+00 -1.227886e+01 -1.414037e+01 -1.706241e+01 -1.513292e+01 -5.279337e+01 DDnBeg 2.012017e+07 2.010453e+07 2.009955e+07 2.009611e+07 2.011068e+07 2.012094e+07 2.010597e+07 DDnN 8.538462e+00 1.026923e+01 1.361538e+01 1.473077e+01 1.569231e+01 7.269231e+00 1.896154e+01 AnnTo 1.490958e+02 1.616830e+02 1.568036e+02 1.609671e+02 1.539729e+02 3.030687e+02 0.000000e+00 Weekly AnnMn 5.983488e-01 8.968437e-01 4.277803e-01 -1.233923e+00 -6.206563e-01 1.219005e+00 -2.371707e+00 AnnSd 3.603818e+00 3.614139e+00 3.088837e+00 3.342272e+00 3.828723e+00 6.091824e+00 9.707049e+00 Sharpe 1.660319e+01 2.481487e+01 1.384923e+01 -3.691867e+01 -1.621053e+01 2.001051e+01 -2.443284e+01 HitRate 3.002611e+00 1.566580e+00 1.436031e+00 0.000000e+00 -1.044386e+00 6.527415e-01 -2.219321e+00 Beta 1.273000e-04 1.593800e-03 -6.092560e-02 2.204970e-02 3.876490e-02 -3.863760e-02 1.000000e+00 Alpha 5.986507e-01 9.006237e-01 2.832825e-01 -1.181627e+00 -5.287173e-01 1.127368e+00 0.000000e+00 DrawDn -8.386794e+00 -8.312592e+00 -1.098149e+01 -2.513949e+01 -1.959935e+01 -1.792222e+01 -6.285831e+01 DDnBeg 2.009021e+07 2.007091e+07 2.012041e+07 2.008023e+07 2.013063e+07 2.009021e+07 2.011043e+07 DDnN 2.300000e+02 1.010000e+02 1.830000e+02 6.440000e+02 4.440000e+02 2.300000e+02 4.640000e+02 AnnTo 3.454544e+03 4.001181e+03 3.975967e+03 4.018637e+03 3.598234e+03 7.052779e+03 0.000000e+00 Annualized mean one-week returns bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay, idx)$annSumm # DISPLAY CALENDAR-YEAR RETURNS Q1 Q2 Q3 Q4 Q5 TxB uRet nPrds 2007 0.2516514 -3.0223681 -3.1650345 0.6431651 5.2925861 -5.0409347 13.1946215 35 2008 2.7409669 -0.7663375 3.2042354 -5.4055047 0.2266398 2.5143271 -13.1533701 52 2009 -1.5291806 -1.6289655 0.1779812 1.9307456 1.4940522 -3.0232327 10.2375370 52 2010 1.2771189 -2.3973535 2.2347541 -1.2789899 -0.3607216 1.6378404 2.9512123 53 2011 -3.4098905 1.6363491 -0.0346503 0.9866233 1.1962787 -4.6061692 -4.1065988 52 2012 0.3759461 1.4990221 -2.2126676 0.5677893 0.0651689 0.3107772 3.4833257 52 2013 -0.4459152 0.1016178 -2.9508640 -0.5948434 3.9570220 -4.4029372 -4.9124563 52 2014 1.4214920 6.1682728 -0.8317866 -2.4685137 -4.9060910 6.3275830 -16.2172346 52 2015 4.9967529 4.6105364 -2.1201550 0.1100902 -8.3839956 13.3807484 -14.6408438 52 2016 0.0178822 -1.7268778 4.4124733 -2.6965363 0.7942841 -0.7764019 -6.0898082 53 2017 1.9424454 0.2965310 1.6799891 -2.1857760 -1.8833822 3.8258276 12.5654405 52 2018 1.0199171 1.8156397 -0.2277828 -7.5473248 4.1207386 -3.1008215 -9.3094558 52 2019 2.0396141 0.5351104 -0.5550176 0.9926044 -3.0963050 5.1359191 -0.9546108 52 2020 -1.7976431 -1.0896345 6.4825526 -4.5150249 1.9562170 -3.7538602 4.7790869 52 2021 -0.0290940 6.1525670 -0.9370289 3.5041970 -7.7443755 7.7152816 -8.2316355 53 2022 NaN NaN NaN NaN NaN NaN NaN 0 output: html_document "],["flow-percentage-dm-rates-strategy.html", "7 Flow-Percentage DM Rates Strategy 7.1 Overview 7.2 Daily Percentage Flow 7.3 Strategy Implementation", " 7 Flow-Percentage DM Rates Strategy 7.1 Overview The Flow-Percentage DM Rates Strategy is a bond based rotation strategy, which ranks different G10 10 Year Rates, based on a percentage flow indicator. This approach uses the stated allocations of bond funds with a cross-border focus and calculates percentage flow into G10 countries. In terms of twenty-day percentage flows, the top fifth of G10 10 year rates outperform the bottom fifth by around 22pbs per year. G10 Countries used in analysis are: United States Europe United Kingdom Japan Australia New Zealand Canada Switzerland Norway Sweden 7.2 Daily Percentage Flow The Flow-Percentage DM Rates Strategy developed by EPFR Global is based on percentage flow into countries via cross-border bond funds. In this section, the reader will gain an understanding of the aggregations which can be used to create a signal as well as the methodology behind daily percentage flow calculations. 7.2.1 Aggregations The first step is defining a subset of data to capture in calculating our signal. This strategy requires; Bond funds with a cross-boarder focus. These are essentially any fund that has a mandate spanning more than one country. The vast majority of these will be global and regional funds. Funds must report both daily flows and country allocations, since these values are needed to calculate Daily Percentage Flow. Cross-border bond funds, which report their country allocations and their fund flows, are a subset of those that only report their fund flows to EPFR. The figure below shows EPFRs coverage of this universe over time compared to our total coverage. Updated at the end of July each year Users looking for more specific detail can customize this aggregation even further using EPFRs fund-level or share class-level granularity. Some good examples would be Active/Passive, ETF or Mutual funds, Institutional or Retail. Users can use these tags to different degrees in creating aggregated signals to backtest. Further detail about this is available in section 3. This can be achieved using fund-level flow files or reaching out to EPFRs quant team for customized aggregations. 7.2.2 Calculation To begin calculating the Daily Percentage flow, we start with our subset of cross-border bond funds. To calculate the funds impact on a country, we scale a funds flow by multiplying it against its stated country allocation, which is available in EPFRs Country Allocation Database, on that day. EPFR releases country allocations of all funds on the \\(23^{\\text{rd}}\\) of each month (or the next available business day) at a monthly frequency. Hence, our calculation assumes constant country allocation between two consecutive release dates within the month. We then apply the same procedure to all funds with a fund flow and country allocation information and then sum the flows for each country across all funds. \\[\\text{Total Impact}_{c,t} = \\sum^{N}_{i=m}{\\text{Flow}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total Impact}\\) = the impact on a country \\(c\\), across all funds \\(i\\), for day \\(t\\) Additionally, we repeat the process across the same funds Assets held under Management (AuM), to get the total AuM held in a country. \\[\\text{Total AuM}_{c,t} = \\sum^{N}_{i=m}{\\text{AuM}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total AuM}\\) = the assets held in a country \\(c\\), across all funds \\(i\\), for day \\(t\\) Finally, to find the daily percentage flow for a country, we divide the Total Impact by the Total AuM. Then we repeat this across all different countries for the entire history. \\[\\text{Percentage Flow}_{c,t} = \\frac{\\text{Total Impact}_{c,t}}{\\text{Total AuM}_{c,t}}\\] Where: \\(\\text{Percentage Flow}\\) = the scaled flow as a percentage into a country \\(c\\), across all funds \\(i\\), for day \\(t\\) 7.2.3 Flow File The users may create flow percentages for their desired country aggregations and granularity using the methodology described in the previous section. EPFR also provides a pre-calculated aggregation for its users for the Flow-Percentage DM Strategy. This file can be found on the FTP under the strategies folder. Please refer to the FTP Folder Structure section for the exact location of this file. This file contains daily cross-border bond fund flow data for 52 countries and is updated daily at 5:00 PM est. with a T+1 day lag. For this demonstration, we use the pre-calculated file FloPctCtry-B-daily.csv. Below shows a snippet of what this file contains. AE AR AT AU BE BR CA CH CL CN CO CZ DE DK EG ES FI FR GB GR HK HU ID IE IL IN IT JO JP KR KW MA MX MY NL NO NZ PE PH PK PL PT QA RU SA SE SG TH TR TW US VN ZA 20211201 0.0003191 -0.0005023 -0.0016232 -0.0007020 -0.0021682 -0.0007263 -0.0015174 0.0004122 -0.0004348 -0.0010957 -0.0003755 -0.0011716 -0.0010397 0.0006928 -0.0003509 -0.0012582 -0.0008343 -0.0008181 -0.0006906 -0.0009452 -0.0000686 -0.0002951 -0.0004524 -0.0006709 -0.0003052 -0.0008780 -0.0010837 0.0002722 -0.0001968 -0.0005403 -0.0007469 -0.0003254 -0.0006705 -0.0002171 -0.0011401 0.0009049 -0.0003805 -0.0002424 0.0006800 0.0006496 -0.0009893 -0.0026106 0.0005718 -0.0002060 0.0005654 0.0001095 -0.0004674 -0.0007752 0.0001892 -0.0024715 -0.0023166 -0.0012180 -0.0006561 20211202 0.0012072 0.0014329 -0.0025294 -0.0004375 -0.0028203 0.0008565 -0.0002560 -0.0002809 0.0008534 0.0009490 0.0008352 0.0008807 -0.0009476 -0.0001855 0.0012131 -0.0002850 -0.0008260 -0.0008015 -0.0004765 -0.0007228 0.0016560 0.0013727 0.0012191 -0.0011799 -0.0015071 0.0012531 -0.0001909 0.0042529 0.0000392 -0.0002019 0.0013321 0.0008123 0.0012001 0.0013374 -0.0013592 -0.0008211 -0.0010253 0.0016993 0.0021569 0.0036010 0.0006459 -0.0001012 0.0017647 0.0021704 0.0013029 -0.0007682 -0.0003907 0.0008492 0.0009959 -0.0039417 -0.0004119 0.0056210 0.0011404 20211203 0.0007654 0.0005456 0.0013883 -0.0003314 0.0013914 -0.0001701 -0.0001907 0.0003749 0.0003603 -0.0001781 0.0001192 -0.0001480 0.0007579 0.0002000 0.0003522 0.0010200 0.0010921 0.0009514 0.0000204 0.0002481 0.0009997 0.0004739 0.0005064 0.0009025 -0.0009385 0.0009783 0.0007720 0.0013244 -0.0007797 0.0001137 0.0005282 0.0009233 0.0001483 0.0002224 0.0007456 -0.0002024 0.0004397 0.0002821 0.0010237 0.0012413 -0.0001590 0.0012930 0.0008190 0.0003348 0.0009350 0.0001894 0.0002016 -0.0002191 0.0008065 -0.0021439 -0.0009936 0.0025527 -0.0002181 20211206 0.0013644 0.0002055 -0.0000573 0.0000657 -0.0005505 0.0003000 -0.0000962 -0.0011922 0.0008670 0.0010817 0.0003184 -0.0002016 -0.0004092 -0.0004426 -0.0001086 0.0002909 -0.0003678 -0.0003619 -0.0005934 -0.0006890 0.0012462 0.0009084 0.0011363 -0.0014591 -0.0005108 0.0007848 0.0007362 0.0001896 0.0005597 0.0000809 0.0014547 0.0002061 0.0004450 0.0011330 -0.0007498 -0.0000267 -0.0003495 0.0010254 0.0016401 0.0007133 0.0009025 -0.0001627 0.0015768 0.0009970 0.0015333 -0.0002973 0.0003065 0.0010730 0.0003986 -0.0001610 -0.0013883 0.0011610 0.0002166 20211207 0.0009266 -0.0019332 -0.0003789 -0.0003327 -0.0005917 -0.0021951 -0.0001279 -0.0005822 0.0003656 -0.0004213 -0.0003040 -0.0015718 -0.0005074 -0.0004684 -0.0046615 -0.0005320 -0.0007327 -0.0005577 -0.0003590 -0.0005685 0.0001428 -0.0032464 -0.0004206 -0.0004412 -0.0013981 -0.0001410 -0.0002394 -0.0002137 0.0000254 -0.0012988 0.0016549 -0.0004101 -0.0007580 -0.0008488 -0.0006225 -0.0005952 -0.0005382 0.0001773 0.0000941 -0.0007931 -0.0010528 -0.0006950 0.0012105 -0.0001711 0.0012085 -0.0007128 0.0001243 -0.0014189 -0.0009974 0.0018590 -0.0005743 -0.0002643 -0.0014092 20211208 0.0010117 0.0006583 0.0001873 -0.0006319 0.0001417 0.0000461 -0.0023702 -0.0002574 0.0004340 -0.0020645 0.0002343 0.0001702 -0.0006398 -0.0002092 0.0005780 -0.0009434 0.0004723 -0.0010668 -0.0007982 0.0008057 0.0002368 0.0004638 -0.0004052 -0.0013087 -0.0009567 -0.0009076 -0.0011703 0.0015317 -0.0008411 -0.0009270 0.0014275 -0.0000628 -0.0003655 -0.0002216 -0.0003228 -0.0022261 -0.0003871 0.0006069 0.0004397 0.0006559 -0.0008703 -0.0002251 0.0009348 0.0006520 0.0008956 0.0003074 -0.0015540 -0.0009851 0.0009139 -0.0010965 -0.0012151 0.0010456 -0.0000831 We will download this file from the ftp using ftp.get(), more about this function can be referred to in section 2.2. file &lt;- &quot;EPFRHistory/Strategies/daily/FloPctCtry-B-daily.csv&quot; # PATH TO .csv FILE fldr &lt;- &quot;C:\\\\temp&quot; # LOCAL FOLDER ftp.get(file, fldr, &quot;filetransport.epfrglobal.com&quot;, w = &quot;username&quot;, h = &quot;password&quot;, &quot;ftp&quot;) # DOWNLOADS FILE FROM FTP TO LOCAL FOLDER, USING CREDENTIALS After downloading the csv file you will store its path as flow.file. A quick way to do this is shown below: flow.file &lt;- paste(fldr, ftp.file(file), sep = &quot;\\\\&quot;) # STORES FLOW FILE PATH, C:\\\\temp\\\\FloPctCtry-B-daily.csv 7.2.4 Return File The return file for this strategy should contain daily bond returns for each of the countries in the flow file, which the user can find with their own resources. EPFR also provides Fund Return data, that can be used as a proxy to returns. To create a return file using EPFR daily flow data, the following equation can be used: \\[\\text{Fund Return}_{c,t} = \\frac{\\sum^{N}_{i=m} \\text{Portfolio Change}_i}{\\sum^{N}_{i=m} \\text{Assets Start}_i}\\] Where: \\(\\text{Fund Return}\\) = the return value of country \\(c\\), across all funds \\(i\\), for day \\(t\\) For this demonstration, we will the file which has been locally named g10rates.csv. ret.file &lt;- &quot;g10rates.csv&quot; For your reference a snippet of our return file looks like this AU CA DE JP NZ NO SE CH GB US 20211201 1.7300 1.494 -0.345 0.065 2.458 1.488 0.147 -0.272 0.820 1.405 20211202 1.6800 1.505 -0.372 0.063 2.423 1.422 0.086 -0.306 0.811 1.446 20211203 1.6100 1.437 -0.391 0.053 2.390 1.471 0.084 -0.313 0.747 1.345 20211206 1.5825 1.523 -0.391 0.045 2.347 1.440 0.071 -0.329 0.738 1.436 20211207 1.6475 1.579 -0.377 0.056 2.418 1.460 0.064 -0.318 0.730 1.476 20211208 1.6200 1.591 -0.315 0.050 2.430 1.517 0.096 -0.287 0.775 1.523 7.3 Strategy Implementation The final step is implementing this strategy to create a signal. Lets begin by reading in the flow and return files to our R studio work space. x &lt;- mat.read(flow.file) # GET FLOW PERCENTAGE y &lt;- mat.read(ret.file) # GET RETURN We must now make sure our files only use G10 countries and have the same columns. We will also subset the flow file \\(x\\) to use the same countries as \\(y\\). x &lt;- x[, is.element(dimnames(x)[[2]],dimnames(y)[[2]])] # SUBSET TO G10 COUNTRIES y &lt;- y[,dimnames(x)[[2]]] * Note: subsetting can be also be done when creating the flow and return files 7.3.1 Compounding Flows Next, we set up a variable for our look-back period, which can also be called a flow window. This variable will be the window of time we use to create a trailing compounded daily percentage flow. The look-back period we choose for our demonstrations is 20 days. lookback &lt;- 20 # FLOW WINDOW (IN WEEKDAYS) - 20 day look back period Again, using a function from the library('EPFR'), compound.flows() compounds the daily percentage flow over the trailing lookback period for each country. x &lt;- compound.flows(x, lookback, F) # COMPOUND FLOWS 7.3.2 Ranking Countries Next, we sort the countries in each universe into five equal bins based on their 20-day Percentage Flow Compounded value for the selected holding period. To do this, we will use the function from library('EPFR'), called bbk(). This function will output a standardized backtest result. The bbk() function requires our compounded daily percentage flow file, a return file, and our selected universe. Please refer to the library documentation for the complete list of parameters of this function. The first parameter we add is the number of bins we want to use. For our case, we want to use 5 because our strategy is to go long the top fifth and short the bottom fifth. nBin &lt;- 5 # NUMBER OF BINS Since EPFR data is published with T+1 day lag and is released around 5:00 pm EST, we account for a T+2 day delay in our model since that is when one can trade on the information. Users interested in more timely signals can also use the T+2 Open Prices for backtesting purposes. EPFR also offers a Premium Daily offering, an earlier release of the end-of-day data covering a significant subset of fund-level flow information. delay &lt;- 2 # DELAY IN KNOWING DATA (IN WEEKDAYS) - data takes time to have It is also important to note that this model will need to be re-balanced weekly. The day of the week the rebalancing occurs is at the discretion of the user. For this example we will set the day of the week to trade as Friday. doW &lt;- 5 # DAY OF THE WEEK YOU WILL TRADE ON (5 = FRIDAYS) Additionally, we also evaluate the returns for different holding periods. The user can input return horizions that they are interested in here. For this example we define a return horizon for weekly, fortnightly, monthly, bi-monthly, quarterly, and semi-annually. hz &lt;- c(5, 10, 20, 45, 65, 130) # RETURN HORIZON (IN WEEKDAYS) - holding periods Now that we have defined all of our inputs, to rank the countries into quintiles by their 20-day percentage flow, we call function bbk() for a 1-week holding period. z &lt;- bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay) 7.3.3 Model 7.3.3.1 Bins Twenty-day flow percentage ranked into quintiles (computed only where forward returns are available) z[[&quot;bins&quot;]] AU CA CH DE GB JP NO NZ SE US 20211231 2 1 5 2 4 1 4 3 3 5 20211224 1 1 4 4 3 2 5 2 3 5 20211217 2 5 1 4 3 4 3 2 1 5 20211210 2 5 1 3 3 4 5 2 1 4 20211203 4 5 1 4 3 2 1 3 2 5 7.3.3.2 BinRets z[[&quot;rets&quot;]] Q1 Q2 Q3 Q4 Q5 TxB uRet 20211231 51.442115 -39.570908 28.0605000 6.266251 -46.197958 97.6400732 7.4724679 20211224 2.463720 4.776837 15.4648343 -25.883092 3.177701 -0.7139815 -0.8314551 20211217 12.257956 -9.276437 6.5525480 -8.296766 -1.237302 13.4952573 9.7792957 20211210 14.047904 -4.970177 5.6663565 -9.253285 -5.490799 19.5387025 0.2760121 20211203 3.469073 -3.888138 0.4014854 -5.360392 5.377972 -1.9088995 0.7659459 7.3.4 Performance Performance over all holding periods fcn &lt;- function(retW) {as.matrix(bbk(x, y, 1, retW, 5, doW, T, 0, delay)$summ)} # DEFINE SUMMARY FUNCTION mat.ex.array3d(sapply(split(hz, hz), fcn, simplify = &quot;array&quot;)) # WRITE SUMMARIES Q1 Q2 Q3 Q4 Q5 TxB uRet Bi-Monthly AnnMn NaN NaN NaN NaN NaN 3.960461e+01 NaN AnnSd NaN NaN NaN NaN NaN 4.433182e+02 NaN Sharpe NaN NaN NaN NaN NaN 1.045168e+01 NaN HitRate 2.605259e+00 -2.872722e+00 7.812737e-01 1.564067e+00 3.191974e-01 1.516095e+00 -7.046664e+00 Beta NaN NaN NaN NaN NaN NaN 1.000000e+00 Alpha NaN NaN NaN NaN NaN NaN 0.000000e+00 DrawDn NaN NaN NaN NaN NaN -1.258419e+03 NaN DDnBeg 2.017503e+07 2.014851e+07 2.016947e+07 2.015502e+07 2.016955e+07 2.016294e+07 2.014724e+07 DDnN 1.122222e+01 2.488889e+01 1.466667e+01 1.755556e+01 1.400000e+01 1.855556e+01 3.022222e+01 AnnTo 4.142944e+02 4.451478e+02 4.500616e+02 4.386741e+02 4.089670e+02 8.232614e+02 0.000000e+00 Fortnightly AnnMn NaN NaN NaN NaN Inf -2.237922e+02 NaN AnnSd NaN NaN NaN NaN NaN 1.139407e+03 NaN Sharpe NaN NaN NaN NaN NaN -2.005806e+01 NaN HitRate -1.370417e+00 -2.876854e+00 4.233981e+00 1.112395e+00 -1.827676e+00 -6.630390e-02 -4.757534e+00 Beta NaN NaN NaN NaN NaN NaN 1.000000e+00 Alpha NaN NaN NaN NaN NaN NaN 0.000000e+00 DrawDn NaN NaN NaN NaN NaN -6.012032e+03 NaN DDnBeg 2.020032e+07 2.020037e+07 2.017547e+07 2.017542e+07 2.015037e+07 2.018102e+07 2.016542e+07 DDnN 7.500000e+00 5.500000e+00 2.050000e+01 7.500000e+01 8.050000e+01 4.400000e+01 1.000000e+00 AnnTo 1.774081e+03 1.918541e+03 1.979709e+03 1.998417e+03 1.836994e+03 3.611075e+03 0.000000e+00 Monthly AnnMn NaN NaN NaN NaN Inf -9.517222e+01 NaN AnnSd NaN NaN NaN NaN NaN 8.127343e+02 NaN Sharpe NaN NaN NaN NaN NaN 2.960262e+00 NaN HitRate 1.901996e-01 -4.522156e+00 2.283759e+00 1.241410e+00 -2.208088e+00 3.526413e+00 -5.408077e+00 Beta NaN NaN NaN NaN NaN NaN 1.000000e+00 Alpha NaN NaN NaN NaN NaN NaN 0.000000e+00 DrawDn NaN NaN NaN NaN NaN -3.865981e+03 NaN DDnBeg 2.020029e+07 2.014819e+07 2.018562e+07 2.019059e+07 2.016569e+07 2.018551e+07 2.018042e+07 DDnN 1.025000e+01 5.675000e+01 1.125000e+01 8.750000e+00 4.100000e+01 2.650000e+01 2.000000e+00 AnnTo 9.131703e+02 9.941024e+02 9.856035e+02 9.907440e+02 9.430060e+02 1.856176e+03 0.000000e+00 Quarterly AnnMn NaN NaN NaN NaN NaN -1.247657e+01 NaN AnnSd NaN NaN NaN NaN NaN 4.706899e+02 NaN Sharpe NaN NaN NaN NaN NaN 9.543250e+00 NaN HitRate 2.623297e+00 2.771777e+00 2.367037e+00 4.585436e+00 -3.371847e-01 6.367467e-01 -1.009082e+01 Beta NaN NaN NaN NaN NaN NaN 1.000000e+00 Alpha NaN NaN NaN NaN NaN NaN 0.000000e+00 DrawDn NaN NaN NaN NaN NaN -1.483752e+03 NaN DDnBeg 2.016146e+07 2.016596e+07 2.017597e+07 2.016994e+07 2.016070e+07 2.015836e+07 2.013987e+07 DDnN 1.492308e+01 1.300000e+01 7.615385e+00 9.307692e+00 1.438462e+01 1.438462e+01 2.207692e+01 AnnTo 2.824934e+02 3.066313e+02 3.169761e+02 3.143236e+02 2.944297e+02 5.769231e+02 0.000000e+00 Semi-Annual AnnMn NaN NaN NaN NaN NaN -1.217973e+01 NaN AnnSd NaN NaN NaN NaN NaN 3.420400e+02 NaN Sharpe NaN NaN NaN NaN NaN 1.742681e+00 NaN HitRate -2.306745e+00 4.078249e+00 6.157635e-01 -1.705191e-01 1.970443e+00 1.373626e-01 -1.053903e+01 Beta NaN NaN NaN NaN NaN NaN 1.000000e+00 Alpha NaN NaN NaN NaN NaN NaN 0.000000e+00 DrawDn NaN NaN NaN NaN NaN -1.121633e+03 NaN DDnBeg 2.015262e+07 2.016450e+07 2.016902e+07 2.015572e+07 2.016339e+07 2.014186e+07 2.011220e+07 DDnN 8.961538e+00 6.461538e+00 5.269231e+00 7.653846e+00 7.423077e+00 1.080769e+01 1.642308e+01 AnnTo 1.486216e+02 1.549829e+02 1.603543e+02 1.541919e+02 1.520083e+02 3.006300e+02 0.000000e+00 Weekly AnnMn NaN NaN NaN NaN NaN -2.953599e+02 NaN AnnSd NaN NaN NaN NaN NaN 1.239273e+03 NaN Sharpe NaN NaN NaN NaN NaN -2.383333e+01 NaN HitRate -2.803129e+00 -2.549020e+00 3.455020e+00 3.594771e+00 -1.697128e+00 0.000000e+00 -4.367666e+00 Beta NaN NaN NaN NaN NaN NaN 1.000000e+00 Alpha NaN NaN NaN NaN NaN NaN 0.000000e+00 DrawDn NaN NaN NaN NaN NaN -8.287086e+03 NaN DDnBeg 2.020011e+07 2.020011e+07 2.020011e+07 2.020052e+07 2.020011e+07 2.019071e+07 2.015023e+07 DDnN 1.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00 6.000000e+01 1.000000e+00 AnnTo 3.536815e+03 3.910183e+03 3.988251e+03 4.028982e+03 3.655614e+03 7.192428e+03 0.000000e+00 Annualized mean one-week returns bbk(x, y, 1, hz[1], 5, doW, T, 0, delay, sprds = T)$annSumm # DISPLAY CALENDAR-YEAR RETURNS Q1 Q2 Q3 Q4 Q5 TxB uRet nPrds 2007 0.5033670 -0.6138451 0.3276700 0.1173064 -0.3026330 0.8060000 -0.0337912 33 2008 -0.2093356 -0.1848356 0.2229644 0.2379644 -0.0766856 -0.1326500 -1.3718144 52 2009 -0.6084222 -0.2835722 1.0324278 -0.1407222 0.0199278 -0.6283500 0.7055722 52 2010 -0.1813143 0.1488366 -0.2382200 0.2213914 -0.0399822 -0.1413321 -0.2631876 53 2011 -0.5316200 -0.6752200 -0.1883200 0.5611800 0.8394300 -1.3710500 -1.3339800 52 2012 -0.1117867 0.3275133 -0.3790867 0.1083133 0.0031133 -0.1149000 -0.2274133 52 2013 -0.1958367 0.0111633 -0.1093367 0.3628133 -0.0899867 -0.1058500 0.8895367 52 2014 -0.2419333 -0.3356333 0.3821167 -0.1591833 0.3064667 -0.5484000 -1.0756667 52 2015 -0.1455556 -0.2805556 -0.0171556 0.4684444 -0.0194556 -0.1261000 -0.1212444 52 2016 -0.0479338 -0.2000092 0.3141040 0.2351229 -0.2966507 0.2487170 -0.1517266 53 2017 0.1266778 -0.3133222 -0.2373222 0.0766778 0.3366778 -0.2100000 -0.0056778 52 2018 -0.1141722 -0.0566722 0.1923278 -0.0126722 -0.0186722 -0.0955000 -0.0833278 52 2019 -0.2295744 0.1840256 0.2881256 0.1624256 -0.3652244 0.1356500 -0.4894756 52 2020 0.0838800 -0.0709200 0.2119300 0.0063300 -0.2312200 0.3151000 -0.4174300 52 2021 -0.0849998 -0.0329508 -0.0682715 0.2065926 -0.0661621 -0.0188377 0.5731621 53 2022 -0.6448000 -0.1187333 0.5936667 -0.1274000 0.2972667 -0.9420667 3.0567333 3 "]]
