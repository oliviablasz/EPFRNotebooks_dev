[["index.html", "EPFR Notebooks Chapter 1 Introduction", " EPFR Notebooks Olivia Blaszkowski 2022-10-24 Chapter 1 Introduction The objective of this book is to present EPFRs proof of concept strategies so that readers have a profound understanding of how to use our EPFRs flow and allocation dataset, construct a signal, and find initial value. This book has nine proof-of-concept strategies created by Quantitative Analysts at EPFR. The backtesting methodology across each of these is relatively similar. They are quintile based, long/short, and we apply similar lookback periods for our backtests. This is because we do not tend to optimize any of these strategies since our goal is simply for the reader to construct a signal from EPFRs data and realize the value. The theory is that from these examples the reader will be able to build upon these models or create their own for more optimized results in the future. For this type of testing on our data, we provide the time series file available for download. (add an interactive field i.e.Â request to download, email sales, or download options) "],["epfr-library.html", "Chapter 2 EPFR Library", " Chapter 2 EPFR Library The EPFR Library has an extensive list of applicable functions for use on our data and will be used in this demonstration of our strategies. To install the library EPFR, click here to download zip from github. library(&#39;EPFR&#39;) "],["flow-percentage-country-strategy.html", "Chapter 3 Flow Percentage Country Strategy 3.1 Overview 3.2 Daily Percentage Flow 3.3 Strategy Implementation", " Chapter 3 Flow Percentage Country Strategy The main focus of this proof of concept is to understand the methodology behind the Flow Percentage Country Strategy. 3.1 Overview This strategy, in particular, is a country rotation strategy, where it chooses different equity markets of countries across the globe. This approach uses the stated allocations of equity funds with a cross-border focus and calculates percentage flow into countries. In terms of twenty-day percentage flows, the top fifth of ACWI countries outperform the bottom fifth by over 6% per year. The strategy works well everywhere but better in Emerging Markets. 3.2 Daily Percentage Flow The Flow Percentage Country Strategy developed by EPFR Global is based on percentage flow into countries. In this section, the reader will understand what types of aggregations can be used to create a signal for this strategy as well as the methodology behind daily percentage flow calculations. Understanding these fundamentals will further supplement a users experience working with these data sets as they continue exploring for value and underlying meaning. 3.2.1 Aggregations The first step is defining a subset of data to capture in calculating our signal. We use equity funds with a cross-border focus for this strategy. Cross-boarder focus: includes global funds, regional funds, Europe regional investing in different countries in Europe, essentially any fund that has a mandate that spans more than one country. We exclude the single country-mandated fund flows from this analysis. The following requirement is that the subset of funds must all be reporting daily flows and country allocations since these values are needed to calculate Daily Percentage Flow. The figure below shows EPFRs coverage over time, which is reported at the end of July each year. As seen below, cross-border funds, which report their country allocations and their fund flows, are a subset of those that only report their fund flows to EPFR. Users looking for more specific detail can customize this aggregation even further using EPFRs fund-level or share class-level granularity. Some good examples would be Active/Passive, ETF or Mutual funds, Institituinal or Retail. Users can use these tags to different degrees in creating aggregated signals to backtest. This can be achieved using fund-level flow files or reaching out to EPFRs quant team for customized aggregations. 3.2.2 Calculation To begin calculating the Daily Percentage flow, we start with our subset of cross-border equity funds. To calculate the funds impact on a country, we scale a funds flow by multiplying it against its stated country allocation, which is available in EPFRs Country Allocation Database, on that day. EPFR releases country allocations of all funds on the \\(23^{\\text{rd}}\\) of each month (or the next available business day) at a monthly frequency. Hence, our calculation assumes constant country allocation between two consecutive release dates within the month. We then apply the same procedure to all funds with a fund flow and country allocation information and then sum the flows for each country across all funds. \\[\\text{Total Impact}_{c,t} = \\sum^{N}_{i=m}{\\text{Flow}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total Impact}\\) = the impact on a country \\(c\\), across all funds \\(i\\), for day \\(t\\) Additionally, we repeat the process across the same funds Assets held under Management (AuM), to get the total AuM held in a country. \\[\\text{Total AuM}_{c,t} = \\sum^{N}_{i=m}{\\text{AuM}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total AuM}\\) = the assets held in a country \\(c\\), across all funds \\(i\\), for day \\(t\\) Finally, to find the daily percentage flow for a country, we divide the Total Impact by the Total AuM. Then we repeat this across all different countries for the entire history. \\[\\text{Percentage Flow}_{c,t} = \\frac{\\text{Total Impact}_{c,t}}{\\text{Total AuM}_{c,t}}\\] Where: \\(\\text{Percentage Flow}\\) = the scaled flow as a percentage into a country \\(c\\), across all funds \\(i\\), for day \\(t\\) 3.2.3 Flow File The users may create flow percentages for their desired country aggregations and granularity using the methodology described in the previous section. EPFR also provides a pre-calculated aggregation for its users for the Daily Flow Percentage Country Strategy. This file can be found on the FTP under the strategies folder. Please refer to the FTP Folder Structure section for the exact location of this file. This file contains daily flow data for 52 countries and is updated daily at 5:00 PM est. with a T+1 day lag. For this demonstration, we use the pre-calculated file. We store this file name/location as below. flow.file &lt;- &quot;FloPctCtry-daily.csv&quot; # PATH TO FLOW PERCENTAGE .csv FILE 3.2.4 Return File The return file can be imported by the users using their own resources. EPFR also provides Fund Return data, that can be used as a proxy to returns. To create a return file using EPFR daily flow data, the following equation can be used: \\[\\text{Fund Return}_{c,t} = \\frac{\\sum^{N}_{i=m} \\text{Portfolio Change}_i}{\\sum^{N}_{i=m} \\text{Assets Start}_i}\\] Where: \\(\\text{Fund Return}\\) = the return value of country \\(c\\), across all funds \\(i\\), for day \\(t\\) For this demonstration, we will use files that have calculated returns using EPFR daily flow data, which has been locally named ETFCountryRetruns.csv. ret.file &lt;- &quot;ETFCountryReturns.csv&quot; 3.3 Strategy Implementation The final step is to implement this strategy to create a signal. Lets begin by reading in the flow file and return files. x &lt;- mat.read(flow.file) # GET FLOW PERCENTAGE y &lt;- mat.read(ret.file) # GET RETURN One of our first options is choosing the universe we want to use. EPFR has tested this signal within three different universes of countries ACWI (All Country World Index), EAFE (Europe, Australasia, and the Far East (EAFE), and EM (Emerging Markets). For this example, we choose ACWI, which has about 50 countries. idx &lt;- &quot;ACWI&quot; Then, to subset the flow file \\(x\\) to the selected universe \\(idx\\) the function Ctry.msci.members.rng() from the library('EPFR') is used. This function returns a list of two letter country codes from \\(idx\\) that are in \\(x\\). x &lt;- x[, is.element(dimnames(x)[[2]], Ctry.msci.members.rng(idx, dimnames(x)[[1]][1], dimnames(x)[[1]][dim(x)[1]]))] # SUBSET TO INDEX COUNTRIES We will also subset the return file \\(y\\) to use the same countries as \\(x\\). y &lt;- y[, dimnames(x)[[2]]] # TOTAL RETURN INDEX * Note: subsetting can be also be done when creating the flow and return files 3.3.1 Compounding Flows Next, we set up a variable for our look-back period, which can also be called a flow window. This variable will be the window of time we use to create a trailing compounded daily percentage flow. The look-back period we choose for our demonstrations is 20 days. lookback &lt;- 20 # FLOW WINDOW (IN WEEKDAYS) - 20 day look back period Again, using a function from the library('EPFR'), compound.flows() compounds the daily percentage flow over the trailing lookback period for each country. x &lt;- compound.flows(x, lookback, 1, F) # COMPOUND FLOWS 3.3.2 Ranking Countries Next, we sort the countries in each universe into five equal bins based on their 20-day Percentage Flow Compounded value for the selected holding period. To do this, we will use the function from library('EPFR'), called bbk(). This function will output a standardized backtest result. Th bbk() function requires our compounded daily percentage flow file, a return file, and our selected universe. Please refer to the library documentation for the complete list of parameters of this function. The first parameter we add is the number of bins we want to use. For our case, we want to use 5 because our strategy is to go long the top fifth and short the bottom fifth. nBin &lt;- 5 # NUMBER OF BINS Since EPFR data is published with T+1 day lag and is released around 5:00 pm EST, we account for a T+2 day delay in our model since that is when one can trade. Users interested in more timely signals can also use the T+2 Open Prices for backtesting purposes. EPFR also offers a Premium Daily offering, an earlier release of the end-of-day data covering a significant subset of fund-level flow information. delay &lt;- 2 # DELAY IN KNOWING DATA (IN WEEKDAYS) - data takes time to have It is also important to note that this model will need to be re-balanced weekly. We will set the day of the week to trade as Friday. doW &lt;- 5 # DAY OF THE WEEK YOU WILL TRADE ON (5 = FRIDAYS) Additionally, we also evaluate the returns for different holding periods. So we define a return horizon for weekly, fortnightly, monthly, bi-monthly, quarterly, and semi-annually. hz &lt;- c(5, 10, 20, 45, 65, 130) # RETURN HORIZON (IN WEEKDAYS) - holding periods Now that we have defined all of our inputs, to rank the countries into quintiles by their 20-day percentage flow, we call function bbk() for a 1-week holding period. z &lt;- bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay, idx) 3.3.3 Model Flow percentage compounded over trailing 20 days mat.to.xlModel(z[[&quot;raw&quot;]], delay, hz[1], F) One-week ahead return (Friday to Friday) mat.to.xlModel(z[[&quot;raw.fwd.rets&quot;]], delay, hz[1], F) Twenty-day flow percentage ranked into quintiles (computed only where forward returns are available) mat.to.xlModel(z[[&quot;bins&quot;]], delay, hz[1], F) Quintile Returns over the equal-weight universe mat.to.xlModel(z[[&quot;rets&quot;]], delay, hz[1], F) 3.3.4 Preformance Performance over all holding periods fcn &lt;- function(retW) {as.matrix(bbk(x, y, 1, retW, 5, doW, T, 0, delay, idx)$summ)} # DEFINE SUMMARY FUNCTION mat.ex.array3d(sapply(split(hz, hz), fcn, simplify = &quot;array&quot;)) # WRITE SUMMARIES Q1 Q2 Q3 Q4 Q5 TxB uRet Bi-Monthly AnnMn -3.579573e+00 -1.274971e+00 8.609835e-01 1.733662e+00 2.393796e+00 -5.973369e+00 5.483049e+00 AnnSd 5.306235e+00 4.794689e+00 4.218349e+00 4.422429e+00 5.891898e+00 9.919211e+00 1.594861e+01 Sharpe -7.022191e+01 -2.691518e+01 2.094577e+01 3.868546e+01 4.389195e+01 -6.566586e+01 3.435824e+01 HitRate -1.228820e+01 -7.654821e+00 5.008247e+00 6.755136e+00 8.547009e+00 -9.424202e+00 1.315040e+01 Beta -1.464750e-01 -1.309620e-02 1.849510e-02 5.991380e-02 8.195470e-02 -2.284297e-01 1.000000e+00 Alpha -2.808237e+00 -1.229924e+00 7.700393e-01 1.418446e+00 1.979678e+00 -4.787916e+00 0.000000e+00 DrawDn -3.031104e+01 -2.120316e+01 -9.647105e+00 -8.423248e+00 -1.032060e+01 -5.458088e+01 -2.647945e+01 DDnBeg 2.015600e+07 2.015635e+07 2.016960e+07 2.017059e+07 2.019930e+07 2.015392e+07 2.018901e+07 DDnN 3.111111e+01 2.811111e+01 1.566667e+01 6.888889e+00 8.333333e+00 3.033333e+01 7.777778e+00 AnnTo 3.705826e+02 4.268674e+02 4.424850e+02 4.410040e+02 3.562482e+02 7.268308e+02 0.000000e+00 Fornightly AnnMn -3.437574e+00 -6.801918e-01 -2.072170e-02 1.341127e+00 2.713102e+00 -6.150677e+00 5.239828e+00 AnnSd 5.644779e+00 4.585896e+00 4.711817e+00 5.081677e+00 7.102637e+00 1.114316e+01 1.547504e+01 Sharpe -6.086744e+01 -1.458415e+01 -6.048035e-01 2.708634e+01 3.825661e+01 -5.520226e+01 3.384004e+01 HitRate -3.672316e+00 -1.977401e+00 -2.824859e-01 4.237288e+00 2.542373e+00 -3.389830e+00 8.192090e+00 Beta -1.047945e-01 -5.238000e-04 3.460300e-03 2.027920e-02 8.235180e-02 -1.871463e-01 1.000000e+00 Alpha -2.891897e+00 -6.782214e-01 -4.709320e-02 1.247638e+00 2.280066e+00 -5.171963e+00 0.000000e+00 DrawDn -3.180937e+01 -1.940332e+01 -1.366348e+01 -1.152279e+01 -1.354643e+01 -6.337471e+01 -3.471675e+01 DDnBeg 2.015546e+07 2.015547e+07 2.017541e+07 2.019555e+07 2.021556e+07 2.015081e+07 2.019012e+07 DDnN 1.645000e+02 1.225000e+02 8.150000e+01 5.500000e+01 7.000000e+00 1.680000e+02 3.050000e+01 AnnTo 9.016761e+02 1.475210e+03 1.612881e+03 1.429510e+03 9.052668e+02 1.806943e+03 0.000000e+00 Monthly AnnMn -4.027109e+00 -9.168022e-01 1.543080e+00 1.569852e+00 1.939936e+00 -5.967045e+00 5.114207e+00 AnnSd 5.422967e+00 4.518594e+00 4.406681e+00 4.873144e+00 6.535425e+00 1.025232e+01 1.575257e+01 Sharpe -7.397492e+01 -2.060420e+01 3.547147e+01 3.284859e+01 2.924981e+01 -5.759416e+01 3.256064e+01 HitRate -7.386364e+00 -2.272727e+00 1.988636e+00 4.261364e+00 7.954546e+00 -8.238636e+00 9.375000e+00 Beta -9.688910e-02 1.446800e-03 -2.559990e-02 5.090220e-02 6.762440e-02 -1.645135e-01 1.000000e+00 Alpha -3.531901e+00 -9.296652e-01 1.670707e+00 1.318480e+00 1.593614e+00 -5.125515e+00 0.000000e+00 DrawDn -3.486826e+01 -1.871316e+01 -7.194837e+00 -1.022386e+01 -1.178726e+01 -6.036919e+01 -3.115392e+01 DDnBeg 2.015092e+07 2.015090e+07 2.015849e+07 2.018549e+07 2.021044e+07 2.015092e+07 2.019014e+07 DDnN 7.725000e+01 5.750000e+01 2.900000e+01 1.975000e+01 7.500000e+00 8.300000e+01 1.525000e+01 AnnTo 6.746622e+02 8.952683e+02 9.450852e+02 8.800442e+02 6.722412e+02 1.346903e+03 0.000000e+00 Quarterly AnnMn -2.902069e+00 -1.496226e+00 4.010040e-01 1.528531e+00 2.607250e+00 -5.509319e+00 5.989698e+00 AnnSd 4.940342e+00 4.814968e+00 4.321219e+00 4.247768e+00 5.476786e+00 9.161907e+00 1.524739e+01 Sharpe -5.984628e+01 -2.947582e+01 8.874022e+00 3.404816e+01 4.885982e+01 -6.097274e+01 4.049393e+01 HitRate -1.114398e+01 -4.591278e+00 8.327854e-01 8.042954e+00 1.112207e+01 -1.089196e+01 1.530791e+01 Beta -1.443002e-01 2.765390e-02 1.436110e-02 4.040230e-02 6.161020e-02 -2.059104e-01 1.000000e+00 Alpha -2.078068e+00 -1.715482e+00 3.119867e-01 1.329838e+00 2.290042e+00 -4.368110e+00 0.000000e+00 DrawDn -2.367514e+01 -1.984715e+01 -1.042152e+01 -7.675276e+00 -9.103370e+00 -4.583099e+01 -2.328108e+01 DDnBeg 2.015458e+07 2.015624e+07 2.017220e+07 2.016535e+07 2.019436e+07 2.015456e+07 2.018968e+07 DDnN 2.084615e+01 1.800000e+01 1.092308e+01 5.153846e+00 4.692308e+00 1.892308e+01 2.923077e+00 AnnTo 2.714954e+02 3.054535e+02 3.165402e+02 3.048691e+02 2.690272e+02 5.405226e+02 0.000000e+00 Semi-Annual AnnMn -1.768490e+00 -1.224993e+00 3.732886e-01 1.248874e+00 1.436482e+00 -3.204972e+00 6.595841e+00 AnnSd 4.945202e+00 4.588290e+00 4.175579e+00 4.577790e+00 5.238167e+00 9.022022e+00 1.423706e+01 Sharpe -4.035056e+01 -2.454191e+01 7.010241e+00 3.063909e+01 2.440938e+01 -3.480812e+01 4.709465e+01 HitRate -1.047830e+01 -7.692308e+00 1.380671e+00 1.077416e+01 7.815582e+00 -9.689349e+00 2.011834e+01 Beta -1.430817e-01 6.598800e-03 2.512100e-02 7.562240e-02 3.564080e-02 -1.787225e-01 1.000000e+00 Alpha -8.764486e-01 -1.297945e+00 2.001832e-01 8.006034e-01 1.238173e+00 -2.114621e+00 0.000000e+00 DrawDn -1.710668e+01 -1.494666e+01 -9.670318e+00 -7.242502e+00 -9.779879e+00 -3.122829e+01 -1.752810e+01 DDnBeg 2.015890e+07 2.016263e+07 2.017112e+07 2.018354e+07 2.018535e+07 2.015543e+07 2.017642e+07 DDnN 8.230769e+00 7.269231e+00 5.000000e+00 2.730769e+00 4.192308e+00 7.730769e+00 2.307692e+00 AnnTo 1.433739e+02 1.633361e+02 1.651544e+02 1.552657e+02 1.544713e+02 2.978452e+02 0.000000e+00 Weekly AnnMn -2.107264e+00 -1.512694e+00 8.995000e-03 8.692430e-02 3.551350e+00 -5.658614e+00 5.171820e+00 AnnSd 6.094134e+00 4.636856e+00 4.735251e+00 5.019102e+00 6.881846e+00 1.143164e+01 1.487190e+01 Sharpe -3.457856e+01 -3.262326e+01 1.899575e-01 1.731870e+00 5.160461e+01 -4.949958e+01 3.477578e+01 HitRate -1.408451e-01 -9.859155e-01 3.802817e+00 -2.676056e+00 2.957746e+00 -4.366197e+00 6.056338e+00 Beta -9.927310e-02 3.604330e-02 -6.182600e-03 3.297510e-02 3.607760e-02 -1.353508e-01 1.000000e+00 Alpha -1.593841e+00 -1.699103e+00 4.097040e-02 -8.361700e-02 3.364763e+00 -4.958604e+00 0.000000e+00 DrawDn -2.510853e+01 -2.318343e+01 -9.741973e+00 -1.119848e+01 -1.548982e+01 -6.348208e+01 -3.837292e+01 DDnBeg 2.015081e+07 2.016010e+07 2.018060e+07 2.020031e+07 2.021102e+07 2.015081e+07 2.018013e+07 DDnN 3.410000e+02 2.380000e+02 1.730000e+02 8.500000e+01 2.000000e+01 3.360000e+02 1.120000e+02 AnnTo 1.177039e+03 2.261471e+03 2.513618e+03 2.184163e+03 1.161415e+03 2.338454e+03 0.000000e+00 Annualized mean one-week returns bbk(x, y, 1, hz[1], 5, doW, T, 0, delay)$annSumm # DISPLAY CALENDAR-YEAR RETURNS Q1 Q2 Q3 Q4 Q5 TxB uRet nPrds 2015 7.4092079 8.1746110 -0.4174013 -10.1771387 -4.8193481 12.228556 -22.199034 28 2016 -3.5573369 -1.2130471 -0.7278066 0.9089647 4.5588176 -8.116155 9.403868 53 2017 -15.0185103 -0.8214747 7.0253952 9.0197980 0.4418414 -15.460352 18.308649 52 2018 0.8932824 -6.3360967 4.4111109 -1.0984977 3.2390335 -2.345751 -12.123279 52 2019 -0.7763539 -7.5154868 -1.4430680 0.1452267 9.5111776 -10.287531 16.383026 52 2020 3.2279560 -4.4152805 0.3118575 -4.5588806 5.4343476 -2.206392 4.955824 52 2021 -4.0871557 0.3777895 -0.5515777 -3.2191774 7.4801213 -11.567277 12.727776 53 2022 7.6208121 14.8148759 4.9761496 0.9834176 -28.3952552 36.016067 -6.838586 13 "],["multi-asset-strategy.html", "Chapter 4 Multi-Asset Strategy 4.1 Overview 4.2 Daily Percentage Flow 4.3 Strategy Implementation", " Chapter 4 Multi-Asset Strategy The main focus of this proof of concept is to understand the methodology behind the Multi-Asset Strategy. 4.1 Overview This strategy, in particular, is an asset class rotation strategy, where it chooses different equity markets of asset classes. This approach uses active equity funds and calculates percentage flow into asset classes. In terms of twenty-day percentage flows, the top fifth of asset classes outperform the bottom fifth by 10% per year. The strategy works well whether you consider only equity or fixed income asset classes. 4.2 Daily Percentage Flow The Multi-Asset Strategy developed by EPFR Global is based on percentage flow into asset classes. In this section, the reader will understand what types of aggregations can be used to create a signal for this strategy as well as the methodology behind daily percentage flow calculations. Understanding these fundamentals will further supplement a users experience working with these data sets as they continue exploring for value and underlying meaning. 4.2.1 Aggregations The first step is defining a subset of data to capture in calculating our signal. We use active equity and/or fixed-income asset classes. The figure below shows EPFRs coverage over time, which is reported at the end of July each year. As seen below, equity and fixed-income funds (i.e.Â Multi-Asset), which report daily fund flows, are a subset of those that report their fund flows to EPFR. Users looking for more specific detail can also create their own universe of asset classes. There is the option to customize this aggregation even further using EPFRs fund-level or share class-level granularity. Some good examples would be Active/Passive, ETF or Mutual funds, Institituinal or Retail. Users can use these tags to different degrees in creating aggregated signals to backtest. This can be achieved using fund-level flow files or reaching out to EPFRs quant team for customized aggregations. 4.2.2 Calculation To begin calculating the Daily Percentage flow, we start with our subset of Multi-Asset funds. To calculate the flow into an asset class, we sum the flows into funds that invest in that asset class. We repeat the process across the same funds Assets held under Management (AuM), to get the total AuM held in an asset class. Finally, to find the daily percentage flow for an asset class, we divide the flow into by the assets held. Then we repeat this across all different asset classes for the entire history. \\[\\text{Percentage Flow}_{c,t} = \\frac{\\sum^{N}_{i=m} \\text{Flow}_{i}}{\\sum^{N}_{i=m}{\\text{AuM}_{i}}}\\] Where: \\(\\text{Percentage Flow}\\) = the scaled flow as a percentage into an asset class \\(c\\), across all funds \\(i\\), for day \\(t\\) 4.2.3 Flow File The users may create flow percentages for their desired Equity and Fixed Income (Multi-Asset) aggregations and granularity using the methodology described in the previous section. EPFR also provides a pre-calculated aggregations for its users for the Multi-Asset Strategy. These files can be found on the FTP under the strategies folder. Please refer to the FTP Folder Structure section for the exact location of this file. These files contains daily flow data for asset classes listed below and are both updated daily at 5:00 PM est. with a T+1 day lag. Asset Classes 7 Global Equity Regions: Asia ex Japan Europe ex UK Japan Latin America Pacific ex Japan United Kingdom United States 10 Fixed Income: Global Emerging Markets Western Europe Bond High Yield Bond Floating Rate Funds USA Treasuries - USA Treasuries - Long USA Treasuries - Short Cash USA Munis Global Fixed Income For this demonstration, we use the pre-calculated files. We store these file names/locations as below. flow.file.Rgn &lt;- &quot;MultiAsset-Rgn-daily.csv&quot; # PATH TO FLOW PERCENTAGE .csv FILE flow.file.FI &lt;- &quot;MultiAsset-FI-daily.csv&quot; # PATH TO FLOW PERCENTAGE .csv FILE flow.file &lt;- c(flow.file.Rgn, flow.file.FI) 4.2.4 Return File The return files can be imported by the users using their own resources. EPFR also provides Fund Return data, that can be used as a proxy to returns. To create a return file using EPFR daily flow data, the following equation can be used: \\[\\text{Fund Return}_{c,t} = \\frac{\\sum^{N}_{i=m} \\text{Portfolio Change}_i}{\\sum^{N}_{i=m} \\text{Assets Start}_i}\\] Where: \\(\\text{Fund Return}\\) = the return value of an asset class \\(c\\), across all funds \\(i\\), for day \\(t\\) For this demonstration, we will use files that have calculated returns using EPFR daily flow data, which has been locally named PsuedoReturns-Rgn.csv and PsuedoReturns-FI.csv. ret.file.Rgn &lt;- &quot;PsuedoReturns-Rgn.csv&quot; ret.file.FI &lt;- &quot;PsuedoReturns-FI.csv&quot; 4.3 Strategy Implementation The final step is to implement this strategy to create a signal. Lets begin by using the function multi.asset() from library('EPFR') to read the flow file. This function simply compiles both data sets together. x &lt;- multi.asset(flow.file) # GET FLOW PERCENTAGE One of the first options we have is choosing the universe we want to use. EPFR has tested this signal within two different universes of asset classes Rgn (7 Region Equity), F.I. (Fixed Income), and both together (Multi). For this example, we choose Multi, which has about 17 asset classes. idx &lt;- &quot;Multi&quot; # Multi/Rgn/FI 4.3.1 Compounding Flows Next, we set up a variable for our look-back period, which can also be called a flow window. This variable will be the window of time we use to create a trailing compounded daily percentage flow. The look-back period we choose for our demonstrations is 20 days. lookback &lt;- 20 # FLOW WINDOW (IN WEEKDAYS) - 20 day look back period Again, using a function from the library('EPFR'), compound.flows() compounds the daily percentage flow over the trailing lookback period for each country. x &lt;- compound.flows(x, lookback, 1, F) # COMPOUND FLOWS 4.3.2 Return file We will then import our two total return files and modify them to be one data frame of total index returns indexed so that time moves forward. To do this we will use function ret.to.idx() from library('EPFR') which will translate these returns to a total return index. We also use the functions map.rname() to ensure the row names of the matrices line up with our flow file and ret.idx.gaps.fix() to replace any NA values. #RGN RETURNS y &lt;- mat.read(ret.file.Rgn) y &lt;- ret.to.idx(map.rname(y, dimnames(x)[[1]])) # CONVERT TO A TOTAL-RETURN INDEX y &lt;- ret.idx.gaps.fix(y) #F.I. RETURNS z &lt;- mat.read(ret.file.FI) z &lt;- ret.to.idx(map.rname(z, dimnames(y)[[1]])) # CONVERT TO A TOTAL-RETURN INDEX #COMBINE RETURN FILES y &lt;- data.frame(y, z)[, dimnames(x)[[2]]] # FINAL TOTAL-RETURN INDEX TABLE y &lt;- y[max(simplify2array(lapply(y, function(x) {find.data(!is.na(x), T)}))):min(simplify2array(lapply(y, function(x) {find.data(!is.na(x), F)}))), ] # ENSURE ALL PIECES HAVE RETURN OVER THE SAME HORIZON Then, to subset the flow file \\(x\\) and return file \\(y\\) to the selected universe \\(idx\\) of asset classes, the function the following code is used. if (idx == &quot;Rgn&quot;) { x &lt;- x[, 1:7] y &lt;- y[, 1:7] } else if (idx == &quot;FI&quot;) { x &lt;- x[, 8:dim(x)[2]] y &lt;- y[, 8:dim(y)[2]] } else { z &lt;- map.rname(portfolio.beta.wrapper(y, &quot;ACWorld&quot;, lookback), dimnames(x)[[1]]) for (j in 1:dim(x)[1]) x[j, ] &lt;- portfolio.residual(unlist(x[j, ]), unlist(z[j, ])) } * Note: subsetting can be also be done when creating the flow and return files 4.3.3 Ranking Asset Classes Next, we sort the countries in each universe into five equal bins based on their 20-day Percentage Flow Compounded value for the selected holding period. To do this, we will use the function from library('EPFR'), called bbk(). This function will output a standardized backtest result. Th bbk() function requires our compounded daily percentage flow file, a return file, and our selected universe. Please refer to the library documentation for the complete list of parameters of this function. The first parameter we add is the number of bins we want to use. For our case, we want to use 5 because our strategy is to go long the top fifth and short the bottom fifth. nBin &lt;- 5 # NUMBER OF BINS Since EPFR data is published with T+1 day lag and is released around 5:00 pm EST, we account for a T+2 day delay in our model since that is when one can trade. Users interested in more timely signals can also use the T+2 Open Prices for backtesting purposes. EPFR also offers a Premium Daily offering, an earlier release of the end-of-day data covering a significant subset of fund-level flow information. delay &lt;- 2 # DELAY IN KNOWING DATA (IN WEEKDAYS) - data takes time to have It is also important to note that this model will need to be re-balanced weekly. We will set the day of the week to trade as Friday. doW &lt;- 5 # DAY OF THE WEEK YOU WILL TRADE ON (5 = FRIDAYS) Additionally, we also evaluate the returns for different holding periods. So we define a return horizon for weekly, fortnightly, monthly, bi-monthly, quarterly, and semi-annually. hz &lt;- c(5, 10, 20, 45, 65, 130) # RETURN HORIZON (IN WEEKDAYS) - holding periods Now that we have defined all of our inputs, to rank the countries into quintiles by their 20-day percentage flow, we call function bbk() for a 1-week holding period. z &lt;- bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay) 4.3.4 Model Flow percentage compounded over trailing 20 days mat.to.xlModel(z[[&quot;raw&quot;]], delay, hz[1], F) One-week ahead return (Friday to Friday) mat.to.xlModel(z[[&quot;raw.fwd.rets&quot;]], delay, hz[1], F) Twenty-day flow percentage ranked into quintiles (computed only where forward returns are available) mat.to.xlModel(z[[&quot;bins&quot;]], delay, hz[1], F) Quintile Returns over the equal-weight universe mat.to.xlModel(z[[&quot;rets&quot;]], delay, hz[1], F) 4.3.5 Preformance Performance over all holding periods fcn &lt;- function(retW) {as.matrix(bbk(x, y, 1, retW, 5, doW, T, 0, delay)$summ)} # DEFINE SUMMARY FUNCTION mat.ex.array3d(sapply(split(hz, hz), fcn, simplify = &quot;array&quot;)) # WRITE SUMMARIES Q1 Q2 Q3 Q4 Q5 TxB uRet Bi-Monthly AnnMn 7.635970e-01 7.397826e-01 7.122453e-01 -1.943031e-01 -2.203148e+00 2.966745e+00 3.414070e+00 AnnSd 5.703049e+00 4.854255e+00 5.453061e+00 4.872437e+00 5.267957e+00 7.488472e+00 9.178851e+00 Sharpe 1.419266e+01 1.544406e+01 1.354719e+01 -4.940614e+00 -4.236819e+01 4.018834e+01 3.734956e+01 HitRate -1.384998e-01 1.058201e+00 3.018985e+00 -5.415500e-01 -9.581388e+00 7.222222e+00 1.509804e+01 Beta -3.174645e-01 1.030534e-01 1.926830e-01 1.455521e-01 -2.066925e-01 -1.107720e-01 1.000000e+00 Alpha 1.840452e+00 4.074328e-01 4.561190e-02 -6.932604e-01 -1.504961e+00 3.345413e+00 0.000000e+00 DrawDn -2.001579e+01 -1.523026e+01 -2.004672e+01 -2.110050e+01 -3.591594e+01 -1.819404e+01 -3.101945e+01 DDnBeg 2.013398e+07 2.011840e+07 2.009293e+07 2.007733e+07 2.008191e+07 2.014288e+07 2.007096e+07 DDnN 4.088889e+01 2.144444e+01 2.566667e+01 3.800000e+01 7.688889e+01 2.244444e+01 7.666667e+00 AnnTo 3.652347e+02 4.015315e+02 4.470992e+02 4.059375e+02 3.744334e+02 7.396681e+02 0.000000e+00 Fornightly AnnMn 1.442381e+00 1.573006e+00 3.935395e-01 -2.208811e-01 -3.638753e+00 5.081134e+00 3.426943e+00 AnnSd 5.401058e+00 4.895209e+00 5.844298e+00 4.732945e+00 5.194209e+00 7.106315e+00 8.320958e+00 Sharpe 2.677673e+01 3.277613e+01 6.567065e+00 -4.519568e+00 -7.018693e+01 7.153031e+01 4.119830e+01 HitRate 5.249344e-01 6.430446e+00 9.186352e-01 5.249344e-01 -8.530184e+00 5.774278e+00 1.233596e+01 Beta -3.238685e-01 1.376663e-01 2.279249e-01 1.113727e-01 -2.361083e-01 -8.776020e-02 1.000000e+00 Alpha 2.551778e+00 1.099451e+00 -3.849375e-01 -6.056432e-01 -2.825251e+00 5.377029e+00 0.000000e+00 DrawDn -1.984602e+01 -1.702294e+01 -1.914383e+01 -2.761772e+01 -5.414657e+01 -1.167558e+01 -3.576917e+01 DDnBeg 2.011612e+07 2.008055e+07 2.010542e+07 2.008047e+07 2.007061e+07 2.017017e+07 2.007106e+07 DDnN 2.145000e+02 1.750000e+01 5.250000e+01 2.200000e+02 3.785000e+02 4.950000e+01 3.150000e+01 AnnTo 1.059386e+03 1.450526e+03 1.760702e+03 1.445395e+03 1.069649e+03 2.129035e+03 0.000000e+00 Monthly AnnMn 9.030652e-01 1.096467e+00 1.592991e+00 -5.327352e-01 -3.247699e+00 4.150764e+00 3.443160e+00 AnnSd 5.664919e+00 4.970418e+00 5.578344e+00 4.596058e+00 5.216193e+00 7.520090e+00 8.803569e+00 Sharpe 1.648706e+01 2.262043e+01 3.007056e+01 -1.149527e+01 -6.338826e+01 5.548760e+01 3.914899e+01 HitRate -7.867181e-01 2.493800e+00 4.597685e+00 1.311656e+00 -1.168917e+01 7.085974e+00 1.194682e+01 Beta -3.267392e-01 1.623399e-01 2.219792e-01 7.645240e-02 -2.136298e-01 -1.131094e-01 1.000000e+00 Alpha 2.027370e+00 5.387789e-01 8.257839e-01 -7.985807e-01 -2.506752e+00 4.534122e+00 0.000000e+00 DrawDn -1.747428e+01 -1.513634e+01 -1.556107e+01 -2.664261e+01 -5.292538e+01 -1.538682e+01 -3.389934e+01 DDnBeg 2.014572e+07 2.010819e+07 2.012542e+07 2.007794e+07 2.007589e+07 2.016296e+07 2.007104e+07 DDnN 6.300000e+01 2.575000e+01 2.625000e+01 1.160000e+02 1.687500e+02 2.350000e+01 1.675000e+01 AnnTo 7.597392e+02 8.737916e+02 9.724237e+02 8.652367e+02 7.843321e+02 1.544071e+03 0.000000e+00 Quarterly AnnMn 7.058165e-01 6.519758e-01 7.942645e-01 -1.851943e-01 -2.122456e+00 2.828273e+00 3.451610e+00 AnnSd 5.993071e+00 4.860626e+00 5.306706e+00 5.055374e+00 5.284020e+00 7.857959e+00 9.179433e+00 Sharpe 1.195884e+01 1.173996e+01 1.414239e+01 -2.811952e+00 -3.976393e+01 3.505460e+01 3.767121e+01 HitRate -6.608821e-01 1.694915e+00 3.263948e+00 1.054264e+00 -1.111810e+01 5.595019e+00 1.746167e+01 Beta -3.225457e-01 9.045280e-02 1.687521e-01 1.866497e-01 -2.156764e-01 -1.068694e-01 1.000000e+00 Alpha 1.795488e+00 3.552444e-01 2.140898e-01 -8.249169e-01 -1.383348e+00 3.178836e+00 0.000000e+00 DrawDn -2.282047e+01 -1.882605e+01 -1.608565e+01 -2.152574e+01 -3.648110e+01 -1.987720e+01 -2.855401e+01 DDnBeg 2.012157e+07 2.011369e+07 2.010760e+07 2.008231e+07 2.008389e+07 2.013920e+07 2.007107e+07 DDnN 2.761538e+01 1.923077e+01 2.023077e+01 2.430769e+01 4.876923e+01 1.923077e+01 4.692308e+00 AnnTo 2.641165e+02 2.823328e+02 3.134410e+02 2.794081e+02 2.723905e+02 5.365071e+02 0.000000e+00 Semi-Annual AnnMn 1.419500e-02 -1.272822e-01 1.144012e+00 4.769958e-01 -1.624492e+00 1.638687e+00 3.264504e+00 AnnSd 5.757576e+00 5.180931e+00 5.467953e+00 5.494893e+00 5.943082e+00 8.168316e+00 9.887262e+00 Sharpe 2.781460e-01 -2.382069e+00 2.067799e+01 9.149410e+00 -3.013122e+01 2.052194e+01 3.310566e+01 HitRate -2.860301e+00 -4.615385e+00 4.986737e+00 2.197171e+00 -1.154288e+01 6.436782e+00 1.798851e+01 Beta -2.237177e-01 7.332260e-02 1.688394e-01 2.074675e-01 -3.195084e-01 9.579070e-02 1.000000e+00 Alpha 7.342073e-01 -3.584744e-01 5.934298e-01 -1.919548e-01 -5.937316e-01 1.327939e+00 0.000000e+00 DrawDn -2.441441e+01 -1.963327e+01 -1.324949e+01 -1.791113e+01 -3.292179e+01 -2.402701e+01 -2.575678e+01 DDnBeg 2.011291e+07 2.011219e+07 2.011445e+07 2.009184e+07 2.008349e+07 2.011673e+07 2.007133e+07 DDnN 1.650000e+01 1.411538e+01 7.076923e+00 8.384615e+00 2.442308e+01 8.500000e+00 2.500000e+00 AnnTo 1.379784e+02 1.464499e+02 1.563376e+02 1.444226e+02 1.385026e+02 2.764810e+02 0.000000e+00 Weekly AnnMn 1.553535e+00 1.983383e+00 3.841690e-01 -3.989662e-01 -4.052587e+00 5.606122e+00 3.476831e+00 AnnSd 5.409883e+00 5.058031e+00 5.886029e+00 4.958011e+00 5.132273e+00 6.716251e+00 8.039942e+00 Sharpe 2.871661e+01 3.921256e+01 6.526794e+00 -8.046901e+00 -7.896281e+01 8.347100e+01 4.324447e+01 HitRate 1.837270e+00 3.149606e+00 6.561680e-01 7.874016e-01 -7.611549e+00 6.561680e+00 7.874016e+00 Beta -2.667200e-01 1.008716e-01 2.424949e-01 1.403368e-01 -2.973800e-01 3.066010e-02 1.000000e+00 Alpha 2.480875e+00 1.632670e+00 -4.589446e-01 -8.868935e-01 -3.018647e+00 5.499522e+00 0.000000e+00 DrawDn -1.467527e+01 -1.703081e+01 -3.106995e+01 -2.821559e+01 -5.957920e+01 -1.279376e+01 -3.582700e+01 DDnBeg 2.012112e+07 2.007092e+07 2.010072e+07 2.008043e+07 2.007061e+07 2.018020e+07 2.007103e+07 DDnN 4.580000e+02 7.200000e+01 1.120000e+02 4.150000e+02 7.600000e+02 3.800000e+01 5.600000e+01 AnnTo 1.432676e+03 2.217346e+03 3.027070e+03 2.260053e+03 1.485064e+03 2.917740e+03 0.000000e+00 Annualized mean one-week returns bbk(x, y, 1, hz[1], 5, doW, T, 0, delay)$annSumm # DISPLAY CALENDAR-YEAR RETURNS Q1 Q2 Q3 Q4 Q5 TxB uRet nPrds 2007 5.5262428 1.1621261 1.3307199 2.9439689 -12.392901 17.9191440 4.083357 29 2008 19.4053704 -13.4654215 7.3922948 -8.3878656 2.340051 17.0653193 -27.417418 52 2009 0.6341039 3.8773276 16.8464068 -5.9257291 -14.749309 15.3834125 24.141740 52 2010 4.2089450 6.6323576 2.9863370 -8.6460349 -4.510379 8.7193238 9.964876 53 2011 4.7583767 -1.7937327 -15.6605055 6.2891454 4.908245 -0.1498686 -2.537112 52 2012 0.6443603 6.2562635 -7.0180903 0.0584413 -2.045876 2.6902368 9.883816 52 2013 -3.2194308 7.6863118 5.5149219 -3.5482053 -7.812966 4.5935357 4.569832 52 2014 1.5277652 2.5782000 1.6069874 -3.1673960 -2.349158 3.8769231 4.051446 52 2015 0.0838904 0.7708154 1.0277650 -0.1808276 -1.898306 1.9821963 -1.968191 52 2016 -2.0358030 2.7496787 4.4755326 -0.9666013 -4.817166 2.7813631 5.941342 53 2017 3.0046060 -0.5971810 -3.9675876 4.3296370 -4.013626 7.0182325 8.457597 52 2018 -6.5752564 -4.7046419 -1.0789123 8.4138797 2.708518 -9.2837747 -6.120206 52 2019 0.0207033 -0.2608606 1.2774272 2.3167628 -4.039333 4.0600368 11.606858 52 2020 -2.8206326 8.4216793 -0.1265118 0.1683652 -8.506248 5.6856156 5.327833 52 2021 0.9314158 10.3067531 -7.2639833 0.1108005 -7.557504 8.4889199 3.660437 53 2022 -24.5647689 -10.9224314 -29.3401241 47.5835662 5.023380 -29.5881489 -32.953700 2 "],["fx-strategy.html", "Chapter 5 FX Strategy 5.1 Overview 5.2 Daily Percentage Flow", " Chapter 5 FX Strategy The main focus of this proof of concept is to understand the methodology behind the FX Strategy. 5.1 Overview This strategy, in particular, is a currency rotation strategy, where it chooses different equity markets of countries across the globe. This approach uses the stated allocations of equity funds with a cross-border focus and calculates percentage flow into currencies. In terms of twenty-day percentage flows, the top fifth of ACWI currencies outperform the bottom fifth by over 5% per year. The strategy works well everywhere but better amongst G10 currencies. 5.2 Daily Percentage Flow The FX Strategy developed by EPFR Global is based on percentage flow into currencies. In this section, the reader will understand what types of aggregations can be used to create a signal for this strategy as well as the methodology behind daily percentage flow calculations. Understanding these fundamentals will further supplement a users experience working with these data sets as they continue exploring for value and underlying meaning. 5.2.1 Aggregations The first step is defining a subset of data to capture in calculating our signal. We use equity funds with a cross-border focus for this strategy. Cross-boarder focus: includes global funds, regional funds, Europe regional investing in different countries in Europe, essentially any fund that has a mandate that spans more than one country. We exclude the single country-mandated fund flows from this analysis. The following requirement is that the subset of funds must all be reporting daily flows and country allocations since these values are needed to calculate Daily Percentage Flow. The figure below shows EPFRs coverage over time, which is reported at the end of July each year. As seen below, cross-border funds, which report their country allocations and their fund flows, are a subset of those that only report their fund flows to EPFR. Users looking for more specific detail can customize this aggregation even further using EPFRs fund-level or share class-level granularity. Some good examples would be Active/Passive, ETF or Mutual funds, Institituinal or Retail. Users can use these tags to different degrees in creating aggregated signals to backtest. This can be achieved using fund-level flow files or reaching out to EPFRs quant team for customized aggregations. 5.2.2 Calculation To begin calculating the Daily Percentage flow, we start with our subset of cross-border equity funds. To calculate the funds impact on a currency, we scale a funds flow by multiplying it against its stated country allocation to countries using that currency, which is available in EPFRs Country Allocation Database, on that day. EPFR releases country allocations of all funds on the \\(23^{\\text{rd}}\\) of each month (or the next available business day) at a monthly frequency. Hence, our calculation assumes constant country allocation between two consecutive release dates within the month. We then apply the same procedure to all funds with a fund flow and country allocation information and then sum the flows for each currency across all funds. \\[\\text{Total Impact}_{c,t} = \\sum^{N}_{i=m}{\\text{Flow}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total Impact}\\) = the impact on a currency \\(c\\), across all funds \\(i\\), for day \\(t\\) Additionally, we repeat the process across the same funds Assets held under Management (AuM), to get the total AuM held in a country. \\[\\text{Total AuM}_{c,t} = \\sum^{N}_{i=m}{\\text{AuM}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total AuM}\\) = the assets held in a currency \\(c\\), across all funds \\(i\\), for day \\(t\\) Finally, to find the daily percentage flow into a currency, we divide the Total Impact by the Total AuM. Then we repeat this across all different currencies for the entire history. \\[\\text{Percentage Flow}_{c,t} = \\frac{\\text{Total Impact}_{c,t}}{\\text{Total AuM}_{c,t}}\\] Where: \\(\\text{Percentage Flow}\\) = the scaled flow as a percentage into a currency \\(c\\), across all funds \\(i\\), for day \\(t\\) 5.2.3 Flow File The users may create flow percentages for their desired FX aggregations and granularity using the methodology described in the previous section. EPFR also provides a pre-calculated aggregation for its users for the FX Strategy. This file can be found on the FTP under the strategies folder. Please refer to the FTP Folder Structure section for the exact location of this file. This file contains daily flow data for 37 currencies and is updated daily at 5:00 PM est. with a T+1 day lag. For this demonstration, we use the pre-calculated file. We store this file name/location as below. flow.file &lt;- &quot;FX-daily.csv&quot; # PATH TO FLOW PERCENTAGE .csv FILE 5.2.4 Return File The return file for this strategy should contain Exchange rates, which the user can find using their own resources. Discuss more For this demonstration, we will the file which has been locally named ExchRates.csv. ret.file &lt;- &quot;ExchRates.csv&quot; "]]
