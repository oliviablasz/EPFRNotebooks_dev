[["index.html", "EPFR Notebooks Chapter 1 Introduction", " EPFR Notebooks Olivia Blaszkowski 2022-10-19 Chapter 1 Introduction The objective of this book is to present EPFRs proof of concept strategies in a way that readers will gain an understanding of how to use our data sets, construct a signal, and find initial value. There are nine different strategies that have been created by EPFRs Quantitative Analysts which will all be covered and demonstrated using our different data sets. The back testing methodology across each of the proofs of concepts being presented here are all fairly similar, as they are quintile based, long/short, and similar look back periods are applied. This is because we do not tend to optimize any of these strategies since our goal is simply for the reader to construct a signal from EPFRs data and realize the value. The theory is that from these examples the reader will be able to build upon these models or create their own for more optimized results in the future. For this type of testing on our data we do provide the time series file available for download. (add an interactive field i.e.Â request to download, email sales, or download options) "],["epfr-library.html", "Chapter 2 EPFR Library", " Chapter 2 EPFR Library The EPFR Library has an extensive list of applicable functions for use on our data and will be used in this demonstration of our strategies. To install the library EPFR, click here to download zip from github. library(&#39;EPFR&#39;) "],["flow-percentage-country-strategy.html", "Chapter 3 Flow Percentage Country Strategy 3.1 Overview 3.2 Daily Percentage Flow 3.3 Strategy Implementation", " Chapter 3 Flow Percentage Country Strategy The main focus of this proof of concept is to understand the methodology behind the Flow Percentage Country Strategy. In this section you will be shown how to use EPFR data to construct a signal and extract value. (add more to intro?) 3.1 Overview Bullet Points might be good here to refer to or expand to be more formal? This strategy in particular is a country rotation strategy, so it chooses different equity markets of countries across the globe. This approach uses the stated allocations of equity funds with cross-boarder focus. The strategy developed by EPFR Global is based on percentage flow into countries. Daily percentage flow is compounded over trailing twenty-day period. The top fifth of ACWI countries, in terms of twenty day percentage flows, outperforms the bottom fifth by over 6% per year. The strategy works well everywhere, but better in Emerging Markets. 3.2 Daily Percentage Flow The Flow Percentage Country Strategy developed by EPFR Global is based on percentage flow into countries. In this section the reader will understand what types of aggregations can be used to create a signal for this strategy as well as the methodology behind daily percentage flow calculations. Understanding both of these fundamentals will further supplement a users experience working with these data sets, as they continue exploring for value and underlying meaning. 3.2.1 Aggregations The first step will be defining a subset of data to capture in the calculation of our signal. For this strategy we will only take equity funds which have a cross-boarder focus. Cross-boarder focus: includes global funds, regional funds, Europe regional investing in different countries in Europe, essentially any fund that has a mandate that spans more than one country. The next requirement is that the subset of funds must all be reporting daily flows and country allocations since these values are needed to calculate Daily Percentage Flow. As you see in the figure below of EPFRs coverage over time, which is reported at the end of July each year, there is a much greater corss-boarder coverage of equity funds with flows and allocations available to be back testing with. If a user is looking for more specific detail they can customize this aggregation even further. Some options can include filtering based on different fund level taggings  such as equity or bond, asset classes, geographic focuses, etf or mutual funds, ect. Any of these tags can be used to different degrees in creating aggregated signals to back test. 3.2.2 Calculation To begin the calculation of Daily Percentage flow, we will start with our subset of equity funds. In this subset every fund will have a reported dollar inflow or outflow for each day. To calculate the funds impact on a country we will scale that flow by multiplying it by its stated country allocation. The next step will be to calculate the total impact on a country by taking the sum across funds. \\[\\text{Total Impact}_{c,t} = \\sum^{N}_{i=m}{\\text{Flow}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total Impact}\\) = the impact on a country \\(c\\), across all funds \\(i\\), for day \\(t\\) Additionally, we repeat the process across funds Assets held under Management (AuM), to get total AuM held in a country. \\[\\text{Total AuM}_{c,t} = \\sum^{N}_{i=m}{\\text{AuM}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total AuM}\\) = the assets held in a country \\(c\\), across all funds \\(i\\), for day \\(t\\) Finally, to find the daily percentage flow for a country you will divide the Total Impact by Total AuM. Then we repeat this across all different countries every single day that we are back testing the data. \\[\\text{Percentage Flow}_{c,t} = \\frac{\\text{Total Impact}_{c,t}}{\\text{Total AuM}_{c,t}}\\] Where: \\(\\text{Percentage Flow}\\) = the scaled flow as a percentage into a country \\(c\\), across all funds \\(i\\), for day \\(t\\) 3.2.3 Flow File Now that we have discussed how daily percentage flow is calculated, the user may create their own flow file for their desired country aggregations. Note: equity funds with cross border mandates that report both daily flows and country allocations only Another option that EPFR has available is their Daily Flow Percentage Country file (FloPctCtry-daily.csv can be found on ftp..). This file contains daily flow data for 52 countries and is updated daily at 5:00 PM est. with a T+1 day lag. For this demonstration we will be using the second option as our flow file. We will store this file location to be used in the next section, Strategy Implementation. flow.file &lt;- &quot;FloPctCtry-daily.csv&quot; # PATH TO FLOW PERCENTAGE .csv FILE 3.2.4 Return File In order to see the strategies performance, the user also needs a return file with corresponding aggregations to their flow file. This file can be independently imported or the user has the option to create one. To create your own return file using EPFR daily flow data, the following equation can be used: \\[\\text{Fund Return}_{c,t} = \\frac{\\sum^{N}_{i=m} \\text{Portfolio Change}_i}{\\sum^{N}_{i=m} \\text{Assets Start}_i}\\] Where: \\(\\text{Fund Return}\\) = the return value of country \\(c\\), across all funds \\(i\\), for day \\(t\\) For this demonstration we will use files that have calculated returns using EPFR daily flow data, which has been locally named ETFCountryRetruns.csv. ret.file &lt;- &quot;ETFCountryReturns.csv&quot; 3.3 Strategy Implementation The final step is to now implement this strategy in order to create a signal. Lets begin by reading in the flow file and return files. x &lt;- mat.read(flow.file) # GET FLOW PERCENTAGE y &lt;- mat.read(ret.file) # GET RETURN One of the first options we have is choosing the universe we want to use. This signal has been heavily tested by EPFR within three different universes of countries ACWI, EAFE, and EMDM. For this example, we are going to choose ACWI which has about 50 countries. idx &lt;- &quot;ACWI&quot; Then, to subset the flow file \\(x\\) to the selected universe \\(idx\\) the function Ctry.msci.members.rng() from the library('EPFR') is used. This function returns a list of two letter country codes from \\(idx\\) that are in \\(x\\). x &lt;- x[, is.element(dimnames(x)[[2]], Ctry.msci.members.rng(idx, dimnames(x)[[1]][1], dimnames(x)[[1]][dim(x)[1]]))] # SUBSET TO INDEX COUNTRIES We will also subset the return file \\(y\\) to use the same countries as \\(x\\). y &lt;- y[, dimnames(x)[[2]]] # TOTAL RETURN INDEX * Note: subsetting can be also be done when creating the flow and return files 3.3.1 Compounding Flows Next, we are going to set up a variable for our look back period which can also be called a flow window. This variable will be the window of time that we use to create a trailing compounded daily percentage flow over, for each country. The look back period we will choose for our demonstrations is 20 days. lookback &lt;- 20 # FLOW WINDOW (IN WEEKDAYS) - 20 day look back period Again, using a function from the library('EPFR'), compound.flows() compounds the daily percentage flow over the trailing lookback period for each country. x &lt;- compound.flows(x, lookback, 1, F) # COMPOUND FLOWS 3.3.2 Ranking Countries The next step of the process is to sort the countries in each universe into five equal bins, which will be based on the value of their 20-day Percentage Flow Compounded. To do this we will use the function from library('EPFR'), called bbk(). This function will output a standard model showing the stages. This function requires our compounded daily percentage flow file, a return file, and our selected universe, but it also requires some other parameters as well. Just like we chose the universe for idx, all of the other parameters we will review can be customized as well. The first parameter we will add is the number of bins we want to use. For our case we want to use 5 because our strategy is to go long the top fifth and short the bottom fifth. nBin &lt;- 5 # NUMBER OF BINS Since EPFR data is published with T+1 day lag and is released around 5:00 pm est, we will need ti account for a T+2 day delay in our model since that is when we are able to trade. delay &lt;- 2 # DELAY IN KNOWING DATA (IN WEEKDAYS) - data takes time to have It is also important to note that this model will need to be re-balanced weekly. We will set the day of the week to trade as Friday. doW &lt;- 5 # DAY OF THE WEEK YOU WILL TRADE ON (5 = FRIDAYS) Additionally we will also want evaluate the returns for different holding periods. So we will define a return horizon, for weekly, fortnightly, monthly, bi-monthly, quarterly, and semi-annually. hz &lt;- c(5, 10, 20, 45, 65, 130) # RETURN HORIZON (IN WEEKDAYS) - holding periods Now that we have defined all of our inputs, to rank the countries into quintiles by their 20-day percentage flow we will call function bbk() for a 1-week holding period. z &lt;- bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay, idx) 3.3.3 Model Flow percentage compounded over trailing 20 days mat.to.xlModel(z[[&quot;raw&quot;]], delay, hz[1], F) One-week ahead return (Friday to Friday) mat.to.xlModel(z[[&quot;raw.fwd.rets&quot;]], delay, hz[1], F) Twenty-day flow percentage ranked into quintiles (computed only where forward returns are available) mat.to.xlModel(z[[&quot;bins&quot;]], delay, hz[1], F) Quintile Returns over the equal-weight universe mat.to.xlModel(z[[&quot;rets&quot;]], delay, hz[1], F) 3.3.4 Preformance Performance over all holding periods fcn &lt;- function(retW) {as.matrix(bbk(x, y, 1, retW, 5, doW, T, 0, delay, idx)$summ)} # DEFINE SUMMARY FUNCTION mat.ex.array3d(sapply(split(hz, hz), fcn, simplify = &quot;array&quot;)) # WRITE SUMMARIES Q1 Q2 Q3 Q4 Q5 TxB uRet Bi-Monthly AnnMn -3.579573e+00 -1.274971e+00 8.609835e-01 1.733662e+00 2.393796e+00 -5.973369e+00 5.483049e+00 AnnSd 5.306235e+00 4.794689e+00 4.218349e+00 4.422429e+00 5.891898e+00 9.919211e+00 1.594861e+01 Sharpe -7.022191e+01 -2.691518e+01 2.094577e+01 3.868546e+01 4.389195e+01 -6.566586e+01 3.435824e+01 HitRate -1.228820e+01 -7.654821e+00 5.008247e+00 6.755136e+00 8.547009e+00 -9.424202e+00 1.315040e+01 Beta -1.464750e-01 -1.309620e-02 1.849510e-02 5.991380e-02 8.195470e-02 -2.284297e-01 1.000000e+00 Alpha -2.808237e+00 -1.229924e+00 7.700393e-01 1.418446e+00 1.979678e+00 -4.787916e+00 0.000000e+00 DrawDn -3.031104e+01 -2.120316e+01 -9.647105e+00 -8.423248e+00 -1.032060e+01 -5.458088e+01 -2.647945e+01 DDnBeg 2.015600e+07 2.015635e+07 2.016960e+07 2.017059e+07 2.019930e+07 2.015392e+07 2.018901e+07 DDnN 3.111111e+01 2.811111e+01 1.566667e+01 6.888889e+00 8.333333e+00 3.033333e+01 7.777778e+00 AnnTo 3.705826e+02 4.268674e+02 4.424850e+02 4.410040e+02 3.562482e+02 7.268308e+02 0.000000e+00 Fornightly AnnMn -3.437574e+00 -6.801918e-01 -2.072170e-02 1.341127e+00 2.713102e+00 -6.150677e+00 5.239828e+00 AnnSd 5.644779e+00 4.585896e+00 4.711817e+00 5.081677e+00 7.102637e+00 1.114316e+01 1.547504e+01 Sharpe -6.086744e+01 -1.458415e+01 -6.048035e-01 2.708634e+01 3.825661e+01 -5.520226e+01 3.384004e+01 HitRate -3.672316e+00 -1.977401e+00 -2.824859e-01 4.237288e+00 2.542373e+00 -3.389830e+00 8.192090e+00 Beta -1.047945e-01 -5.238000e-04 3.460300e-03 2.027920e-02 8.235180e-02 -1.871463e-01 1.000000e+00 Alpha -2.891897e+00 -6.782214e-01 -4.709320e-02 1.247638e+00 2.280066e+00 -5.171963e+00 0.000000e+00 DrawDn -3.180937e+01 -1.940332e+01 -1.366348e+01 -1.152279e+01 -1.354643e+01 -6.337471e+01 -3.471675e+01 DDnBeg 2.015546e+07 2.015547e+07 2.017541e+07 2.019555e+07 2.021556e+07 2.015081e+07 2.019012e+07 DDnN 1.645000e+02 1.225000e+02 8.150000e+01 5.500000e+01 7.000000e+00 1.680000e+02 3.050000e+01 AnnTo 9.016761e+02 1.475210e+03 1.612881e+03 1.429510e+03 9.052668e+02 1.806943e+03 0.000000e+00 Monthly AnnMn -4.027109e+00 -9.168022e-01 1.543080e+00 1.569852e+00 1.939936e+00 -5.967045e+00 5.114207e+00 AnnSd 5.422967e+00 4.518594e+00 4.406681e+00 4.873144e+00 6.535425e+00 1.025232e+01 1.575257e+01 Sharpe -7.397492e+01 -2.060420e+01 3.547147e+01 3.284859e+01 2.924981e+01 -5.759416e+01 3.256064e+01 HitRate -7.386364e+00 -2.272727e+00 1.988636e+00 4.261364e+00 7.954546e+00 -8.238636e+00 9.375000e+00 Beta -9.688910e-02 1.446800e-03 -2.559990e-02 5.090220e-02 6.762440e-02 -1.645135e-01 1.000000e+00 Alpha -3.531901e+00 -9.296652e-01 1.670707e+00 1.318480e+00 1.593614e+00 -5.125515e+00 0.000000e+00 DrawDn -3.486826e+01 -1.871316e+01 -7.194837e+00 -1.022386e+01 -1.178726e+01 -6.036919e+01 -3.115392e+01 DDnBeg 2.015092e+07 2.015090e+07 2.015849e+07 2.018549e+07 2.021044e+07 2.015092e+07 2.019014e+07 DDnN 7.725000e+01 5.750000e+01 2.900000e+01 1.975000e+01 7.500000e+00 8.300000e+01 1.525000e+01 AnnTo 6.746622e+02 8.952683e+02 9.450852e+02 8.800442e+02 6.722412e+02 1.346903e+03 0.000000e+00 Quarterly AnnMn -2.902069e+00 -1.496226e+00 4.010040e-01 1.528531e+00 2.607250e+00 -5.509319e+00 5.989698e+00 AnnSd 4.940342e+00 4.814968e+00 4.321219e+00 4.247768e+00 5.476786e+00 9.161907e+00 1.524739e+01 Sharpe -5.984628e+01 -2.947582e+01 8.874022e+00 3.404816e+01 4.885982e+01 -6.097274e+01 4.049393e+01 HitRate -1.114398e+01 -4.591278e+00 8.327854e-01 8.042954e+00 1.112207e+01 -1.089196e+01 1.530791e+01 Beta -1.443002e-01 2.765390e-02 1.436110e-02 4.040230e-02 6.161020e-02 -2.059104e-01 1.000000e+00 Alpha -2.078068e+00 -1.715482e+00 3.119867e-01 1.329838e+00 2.290042e+00 -4.368110e+00 0.000000e+00 DrawDn -2.367514e+01 -1.984715e+01 -1.042152e+01 -7.675276e+00 -9.103370e+00 -4.583099e+01 -2.328108e+01 DDnBeg 2.015458e+07 2.015624e+07 2.017220e+07 2.016535e+07 2.019436e+07 2.015456e+07 2.018968e+07 DDnN 2.084615e+01 1.800000e+01 1.092308e+01 5.153846e+00 4.692308e+00 1.892308e+01 2.923077e+00 AnnTo 2.714954e+02 3.054535e+02 3.165402e+02 3.048691e+02 2.690272e+02 5.405226e+02 0.000000e+00 Semi-Annual AnnMn -1.768490e+00 -1.224993e+00 3.732886e-01 1.248874e+00 1.436482e+00 -3.204972e+00 6.595841e+00 AnnSd 4.945202e+00 4.588290e+00 4.175579e+00 4.577790e+00 5.238167e+00 9.022022e+00 1.423706e+01 Sharpe -4.035056e+01 -2.454191e+01 7.010241e+00 3.063909e+01 2.440938e+01 -3.480812e+01 4.709465e+01 HitRate -1.047830e+01 -7.692308e+00 1.380671e+00 1.077416e+01 7.815582e+00 -9.689349e+00 2.011834e+01 Beta -1.430817e-01 6.598800e-03 2.512100e-02 7.562240e-02 3.564080e-02 -1.787225e-01 1.000000e+00 Alpha -8.764486e-01 -1.297945e+00 2.001832e-01 8.006034e-01 1.238173e+00 -2.114621e+00 0.000000e+00 DrawDn -1.710668e+01 -1.494666e+01 -9.670318e+00 -7.242502e+00 -9.779879e+00 -3.122829e+01 -1.752810e+01 DDnBeg 2.015890e+07 2.016263e+07 2.017112e+07 2.018354e+07 2.018535e+07 2.015543e+07 2.017642e+07 DDnN 8.230769e+00 7.269231e+00 5.000000e+00 2.730769e+00 4.192308e+00 7.730769e+00 2.307692e+00 AnnTo 1.433739e+02 1.633361e+02 1.651544e+02 1.552657e+02 1.544713e+02 2.978452e+02 0.000000e+00 Weekly AnnMn -2.107264e+00 -1.512694e+00 8.995000e-03 8.692430e-02 3.551350e+00 -5.658614e+00 5.171820e+00 AnnSd 6.094134e+00 4.636856e+00 4.735251e+00 5.019102e+00 6.881846e+00 1.143164e+01 1.487190e+01 Sharpe -3.457856e+01 -3.262326e+01 1.899575e-01 1.731870e+00 5.160461e+01 -4.949958e+01 3.477578e+01 HitRate -1.408451e-01 -9.859155e-01 3.802817e+00 -2.676056e+00 2.957746e+00 -4.366197e+00 6.056338e+00 Beta -9.927310e-02 3.604330e-02 -6.182600e-03 3.297510e-02 3.607760e-02 -1.353508e-01 1.000000e+00 Alpha -1.593841e+00 -1.699103e+00 4.097040e-02 -8.361700e-02 3.364763e+00 -4.958604e+00 0.000000e+00 DrawDn -2.510853e+01 -2.318343e+01 -9.741973e+00 -1.119848e+01 -1.548982e+01 -6.348208e+01 -3.837292e+01 DDnBeg 2.015081e+07 2.016010e+07 2.018060e+07 2.020031e+07 2.021102e+07 2.015081e+07 2.018013e+07 DDnN 3.410000e+02 2.380000e+02 1.730000e+02 8.500000e+01 2.000000e+01 3.360000e+02 1.120000e+02 AnnTo 1.177039e+03 2.261471e+03 2.513618e+03 2.184163e+03 1.161415e+03 2.338454e+03 0.000000e+00 Annualized mean one-week returns bbk(x, y, 1, hz[1], 5, doW, T, 0, delay)$annSumm # DISPLAY CALENDAR-YEAR RETURNS Q1 Q2 Q3 Q4 Q5 TxB uRet nPrds 2015 7.4092079 8.1746110 -0.4174013 -10.1771387 -4.8193481 12.228556 -22.199034 28 2016 -3.5573369 -1.2130471 -0.7278066 0.9089647 4.5588176 -8.116155 9.403868 53 2017 -15.0185103 -0.8214747 7.0253952 9.0197980 0.4418414 -15.460352 18.308649 52 2018 0.8932824 -6.3360967 4.4111109 -1.0984977 3.2390335 -2.345751 -12.123279 52 2019 -0.7763539 -7.5154868 -1.4430680 0.1452267 9.5111776 -10.287531 16.383026 52 2020 3.2279560 -4.4152805 0.3118575 -4.5588806 5.4343476 -2.206392 4.955824 52 2021 -4.0871557 0.3777895 -0.5515777 -3.2191774 7.4801213 -11.567277 12.727776 53 2022 7.6208121 14.8148759 4.9761496 0.9834176 -28.3952552 36.016067 -6.838586 13 "],["multi-asset-strategy.html", "Chapter 4 Multi Asset Strategy 4.1 Overview 4.2 Methodology", " Chapter 4 Multi Asset Strategy The main focus of this proof of concept is to understand the methodology behind the Multi Asset Strategy. In this section you will be shown how to use EPFR data to construct a signal and extract value. (add more to intro) 4.1 Overview EPFRs Multi Asset Strategy is based on percentage flow into asset classes. Daily percentage flow is compounded over a trailing twenty day period. The top fifth of asset classes, in terms of twenty day percentage flows, outperforms the bottom fifth by 10% per year. The strategy works well whether you consider only equity or fixed income asset classes. 4.1.1 Downloading Data The Multi Asset strategy uses data from EPFRs Daily Multi Asset files (MultiAsset-Rgn-daily.csv and MultiAsset-FI-daily.csv can be found on ftp..). These files contain daily flow data for different asset classes listed below and are updated daily at 5:00 PM est. with a T+1 day lag. Asset Classes 7 Global Equity Regions: Asia ex Japan Europe ex UK Japan Latin America Pacific ex Japan United Kingdom United States 10 Fixed Income: Global Emerging Markets Western Europe Bond High Yield Bond Floating Rate Funds USA Treasuries - USA Treasuries - Long USA Treasuries - Short Cash USA Munis Global Fixed Income 4.2 Methodology We calculate the flow into an asset class as the sum of flows into funds that invest in that asset class. We calculate the assets held in an asset class as the sum of the assets of funds that invest in that asset class. For equity funds, these sums are computed only across active funds. Divide flow into by assets held in an asset class to get daily percentage flow into that asset class. When using both equity and fixed income assets classes (i.e.Â Multi asset), regress twenty day beta versus MSCI ACWI out of twenty day flow percentage. As you see in the figure below of EPFRs coverage over time, which is reported at the end of July each year, there is good coverage available to be back testing with. 4.2.1 Calculation of Daily Percentage Flow 4.2.2 Strategy Implementation For each asset class, compound daily percentage flow over the trailing twenty days (lookback). Rank asset classes into five equal baskets based on twenty day percentage flow. Go long the top fifth and short the bottom fifth. Re-balance weekly. 4.2.2.1 Defining Variables idx &lt;- &quot;Multi&quot; # Multi/Rgn/FI strats &lt;- c(&quot;Rgn&quot;, &quot;FI&quot;) fldrs &lt;- paste(fcn.dir(), &quot;New Model Concept&quot;, strats, &quot;FloMo\\\\csv&quot;, sep = &quot;\\\\&quot;) lookback &lt;- 20 # FLOW WINDOW (IN WEEKDAYS) - 20 day look back period delay &lt;- 2 # DELAY IN KNOWING DATA (IN WEEKDAYS) - data takes time to have doW &lt;- 5 # TRADE ON FRIDAYS hz &lt;- c(5, 10, 20, 45, 65, 130) # RETURN HORIZON (IN WEEKDAYS) 4.2.2.2 Compounding Daily Percentage Flow Import the multi asset files for equity and fixed income asset classes, and then use function from EPFR library to compound flows. x &lt;- multi.asset(strat.path(paste(&quot;MultiAsset&quot;, strats, sep = &quot;-&quot;), &quot;daily&quot;)) # GET FLOW PERCENTAGE x &lt;- compound.flows(x, lookback, 1, F) # COMPOUND FLOWS 4.2.2.3 Return File For this demonstration we will use files that have calculated returns using EPFR daily flow data for both equity and fixed income asset classes. To do this we use the following equation for each weekday \\(t\\): \\[\\text{Fund Return}_t = \\frac{\\sum \\text{Portfolio Change}}{\\sum \\text{Assets Start}}\\] We will then import this file and use functions from the EPFR library which will easily translate these returns to a total return index. #RGN RETURNS y &lt;- mat.read(paste(fcn.dir(), &quot;New Model Concept\\\\Strategy Notebooks\\\\csv&quot;, &quot;sql.1dFloMo.Rgn.csv&quot;, sep = &quot;\\\\&quot;)) y &lt;- ret.to.idx(map.rname(y, dimnames(x)[[1]])) # CONVERT TO A TOTAL-RETURN INDEX y &lt;- ret.idx.gaps.fix(y) #F.I. RETURNS z &lt;- mat.read(paste(fcn.dir(), &quot;New Model Concept\\\\Strategy Notebooks\\\\csv&quot;, &quot;sql.1dFloMo.FI.csv&quot;, sep = &quot;\\\\&quot;)) z &lt;- ret.to.idx(map.rname(z, dimnames(y)[[1]])) # CONVERT TO A TOTAL-RETURN INDEX #COMBINE RETURN FILES y &lt;- data.frame(y, z)[, dimnames(x)[[2]]] # FINAL TOTAL-RETURN INDEX TABLE y &lt;- y[max(simplify2array(lapply(y, function(x) {find.data(!is.na(x), T)}))):min(simplify2array(lapply(y, function(x) {find.data(!is.na(x), F)}))), ] # ENSURE ALL PIECES HAVE RETURN OVER THE SAME HORIZON Below shows the next steps to filter the return file that will be used in the strategy implementation. if (idx == &quot;Rgn&quot;) { x &lt;- x[, 1:7] y &lt;- y[, 1:7] } else if (idx == &quot;FI&quot;) { x &lt;- x[, 8:dim(x)[2]] y &lt;- y[, 8:dim(y)[2]] } else { z &lt;- map.rname(portfolio.beta.wrapper(y, &quot;ACWorld&quot;, lookback), dimnames(x)[[1]]) for (j in 1:dim(x)[1]) x[j, ] &lt;- portfolio.residual(unlist(x[j, ]), unlist(z[j, ])) } 4.2.3 Preformance Next, the bbk() function from EPFRs library is used to show the performance of this strategy. bbk(x, y, 1, hz[1], 5, doW, T, 0, delay)$annSumm # DISPLAY CALENDAR-YEAR RETURNS fcn &lt;- function(retW) {as.matrix(bbk(x, y, 1, retW, 5, doW, T, 0, delay)$summ)} # DEFINE SUMMARY FUNCTION mat.ex.array3d(sapply(split(hz, hz), fcn, simplify = &quot;array&quot;)) # WRITE SUMMARIES 4.2.3.1 Excel Models add to this section, use embedded tables or take format from presentation Flow percentage Flow percentage compounded over trailing 20 days # EXCEL MODEL z &lt;- bbk(x, y, 1, hz[1], 5, doW, T, 0, delay) mat.to.xlModel(z[[&quot;raw&quot;]]) # FOR MULTI-ASSET, DO TWICE. ONCE WITH AND ONCE WITHOUT BETA NEUTRALIZATION. MAKE SURE LAST TRADE DATE IS THE SAME AS ORTH!! Returns One-week ahead return (Friday to Friday) mat.to.xlModel(z[[&quot;raw.fwd.rets&quot;]]) "],["fx-strategy.html", "Chapter 5 FX Strategy 5.1 Overview 5.2 Daily Percentage Flow", " Chapter 5 FX Strategy The main focus of this proof of concept is to understand the methodology behind the FX Strategy. In this section you will be shown how to use EPFR data to construct a signal and extract value. (add more to intro?) 5.1 Overview EPFR have developed a new currency trading strategy. This approach uses the stated allocations of equity funds with a cross border focus. The strategy developed by EPFR Global is based on percentage flow into currencies. Daily percentage flow is compounded over a trailing twenty day period. The top fifth of ACWI currencies, in terms of twenty day percentage flows, outperforms the bottom fifth by over 5% per year. The strategy does well, particularly when picking amongst G10 currencies. 5.2 Daily Percentage Flow The FX Strategy developed by EPFR Global is based on percentage flow into countries. In this section the reader will understand what types of aggregations can be used to create a signal for this strategy as well as the methodology behind daily percentage flow calculations. Understanding both of these fundamentals will further supplement a users experience working with these data sets, as they continue exploring for value and underlying meaning. 5.2.1 Aggregations The first step will be defining a subset of data to capture in the calculation of our signal. For this strategy we will only take equity funds which have a cross-boarder focus. Cross-boarder focus: includes global funds, regional funds, Europe regional investing in different countries in Europe, essentially any fund that has a mandate that spans more than one country. The next requirement is that the subset of funds must all be reporting daily flows and country allocations since these values are needed to calculate Daily Percentage Flow. As you see in the figure below of EPFRs coverage over time, which is reported at the end of July each year, there is a much greater corss-boarder coverage of equity funds with flows and allocations available to be back testing with. If a user is looking for higher granularity they can customize this aggregation even further. Some options can include filtering based on different fund level taggings  such as equity or bond, asset classes, geographic focuses, etf or mutual funds, ect. Any of these tags can be used to different degrees in creating aggregated signals to back test. 5.2.2 Calculation To begin the calculation of Daily Percentage flow, we will start with our subset of equity funds. In this subset every fund will have a reported dollar inflow or outflow for each day. To calculate the funds impact on a currency we will scale their flow by multiplying it by its total allocation to countries using that currency. The next step will be to calculate the total impact on a currency by taking the sum across funds. \\[\\text{Total Impact}_{c,t} = \\sum^{N}_{i=m}{\\text{Flow}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total Impact}\\) = the impact on a currency \\(c\\), across all funds \\(i\\), for day \\(t\\) Additionally, we repeat the process across funds Assets held under Management (AuM), to get total AuM held in a currency. \\[\\text{Total AuM}_{c,t} = \\sum^{N}_{i=m}{\\text{AuM}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total AuM}\\) = the assets held in a currency \\(c\\), across all funds \\(i\\), for day \\(t\\) Finally, to find the daily percentage flow into a currency you will divide the Total Impact by Total AuM. Then we repeat this across all different countries every single day that we are back testing the data. \\[\\text{Percentage Flow}_{c,t} = \\frac{\\text{Total Impact}_{c,t}}{\\text{Total AuM}_{c,t}}\\] Where: \\(\\text{Percentage Flow}\\) = the scaled flow as a percentage into a currency \\(c\\), across all funds \\(i\\), for day \\(t\\) 5.2.3 Flow File Now that we have discussed how daily percentage flow is calculated, the user may request or create their own flow file for their desired aggregations. Note: equity funds with cross border mandates that report both daily flows and country allocations only For this EPFR has available is their Daily Flow Percentage Country file (FloPctCtry-daily.csv can be found on ftp..). This file contains daily flow data for 52 countries and is updated daily at 5:00 PM est. with a T+1 day lag. For this demonstration we will be using the second option as our flow file. We will store this file location to be used in the next section, Strategy Implementation. flow.file &lt;- &quot;.csv&quot; # PATH TO FLOW PERCENTAGE .csv FILE 5.2.4 Return File In order to see the strategies performance, the user also needs a return file with corresponding aggregations to their flow file. This file can be independently imported or the user has the option to create one. To create your own return file using EPFR daily flow data, the following equation can be used: \\[\\text{Fund Return}_{c,t} = \\frac{\\sum^{N}_{i=m} \\text{Portfolio Change}_i}{\\sum^{N}_{i=m} \\text{Assets Start}_i}\\] Where: \\(\\text{Fund Return}\\) = the return value of country \\(c\\), across all funds \\(i\\), for day \\(t\\) "]]
